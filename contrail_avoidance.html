<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Contrail Avoidance</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/sql-wasm.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
      :root {
        --primary-color: #85b09a;
        --primary-light: #a8c7b5;
        --primary-dark: #6a9179;
      }
      /* tooltip styles for control panel */
      .tooltip {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        overflow: visible;
        width: 100%;
      }
      .tooltip-icon {
        display: inline-block;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--primary-color);
        color: #fff;
        font-size: 12px;
        line-height: 18px;
        text-align: center;
        cursor: default;
      }
      .tooltip-text {
        position: absolute;
        bottom: calc(100% + 12px);
        left: 0; /* align to left edge of control */
        transform: translateY(0);
        width: 100%; /* match container width */
        max-width: none;
        box-sizing: border-box;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: #333;
        padding: 12px 14px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        font-size: 13px;
        line-height: 1.4;
        white-space: normal; /* allow wrapping */
        word-break: break-word;
        pointer-events: none;
        opacity: 0;
        transition:
          opacity 0.2s ease,
          transform 0.2s ease;
        z-index: 9999;
        box-shadow:
          0 8px 24px rgba(0, 0, 0, 0.15),
          0 4px 8px rgba(0, 0, 0, 0.08);
        /* Prevent tooltip from overflowing page edges */
        margin-left: 8px;
        margin-right: 8px;
        left: auto;
        right: auto;
        /* Responsive max width: always leave margin at viewport edge */
        max-width: calc(100vw - 32px);
      }
      .tooltip-text::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 20px;
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 8px solid rgba(255, 255, 255, 0.95);
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
      }
      .tooltip:focus-within .tooltip-text,
      .tooltip:hover .tooltip-text,
      .tooltip .tooltip-text.visible {
        opacity: 1;
        transform: translateX(-50%) translateY(-4px);
        pointer-events: auto;
      }
      .tooltip:focus-within .tooltip-text.small,
      .tooltip:hover .tooltip-text.small,
      .tooltip .tooltip-text.small.visible {
        opacity: 1;
        transform: translateX(-50%) translateY(-4px);
        pointer-events: auto;
      }
      .tooltip-text.small {
        font-size: 20px;
        max-width: 1000px;
        width: auto !important;
        left: 50% !important;
        right: auto !important;
        transform: translateX(-50%);
        text-align: left;
        line-height: 1.25;
        min-width: 300px;
      }
      .tooltip-text.small::after {
        left: 50%;
        transform: translateX(-50%);
      }
      .tooltip-icon:focus {
        outline: 2px solid var(--primary-light);
      }

      /* Enhanced Plotly tooltip styles */
      .plotly .hovertext {
        backdrop-filter: blur(8px) !important;
        -webkit-backdrop-filter: blur(8px) !important;
        box-shadow:
          0 8px 24px rgba(0, 0, 0, 0.15),
          0 4px 8px rgba(0, 0, 0, 0.08) !important;
        border-radius: 10px !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
      }

      .plotly .hovertext path {
        fill: rgba(255, 255, 255, 0.95) !important;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1)) !important;
      }

      /* Additional tooltip enhancements for any dynamically generated tooltips */
      .plotly-tooltip,
      .js-plotly-plot .plotly .hovertext,
      [data-toggle="tooltip"] {
        backdrop-filter: blur(8px) !important;
        -webkit-backdrop-filter: blur(8px) !important;
        background: rgba(255, 255, 255, 0.95) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        border-radius: 10px !important;
        box-shadow:
          0 8px 24px rgba(0, 0, 0, 0.15),
          0 4px 8px rgba(0, 0, 0, 0.08) !important;
        font-family: "DM Sans", Arial, sans-serif !important;
      }
      body {
        font-family: "DM Sans", Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }

      h2 {
        color: #333;
        margin-top: 0;
      }

      .data-source-panel {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .drop-zone {
        border: 2px dashed #ccc;
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        margin: 10px 0;
        transition: all 0.3s;
        cursor: pointer;
      }

      .drop-zone:hover,
      .drop-zone.drag-over {
        border-color: var(--primary-color);
        background: #f0f7f3;
      }
      .drop-zone.hidden {
        opacity: 0;
        height: 0px;
        padding: 0px;
        overflow: hidden;
        pointer-events: none;
        transition:
          opacity 0.2s ease,
          height 0.2s ease,
          padding 0.2s ease;
      }
      .data-source-panel:hover .drop-zone.hidden {
        opacity: 1;
        height: auto;
        padding: 40px;
        pointer-events: auto;
      }

      .control-panel {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        align-items: center;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
        min-width: 200px;
      }

      .control-panel label {
        font-weight: bold;
        font-size: 14px;
        color: #333;
      }

      .control-panel select {
        padding: 8px 12px;
        border-radius: 4px;
        border: 2px solid #ddd;
        font-size: 14px;
        cursor: pointer;
        transition: border-color 0.2s;
        background: white;
      }

      .control-panel select:hover {
        border-color: var(--primary-light);
      }

      .control-panel select:focus {
        outline: none;
        border-color: var(--primary-color);
      }

      /* Multi-select checkbox styles */
      .multi-select-container {
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        min-height: 40px;
        max-height: 200px;
        overflow-y: auto;
        padding: 8px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .multi-select-container:hover {
        border-color: #bbb;
      }

      .multi-select-container:focus-within {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 2px rgba(133, 176, 154, 0.1);
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 4px 0;
        cursor: pointer;
      }

      .checkbox-item input[type="checkbox"] {
        margin: 0;
        cursor: pointer;
      }

      .checkbox-item input[type="checkbox"]:indeterminate {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .checkbox-item label {
        margin: 0;
        cursor: pointer;
        font-size: 14px;
        line-height: 1.2;
        flex: 1;
      }

      .checkbox-item:hover {
        background-color: rgba(133, 176, 154, 0.05);
        border-radius: 2px;
      }

      .multi-select-summary {
        font-size: 12px;
        color: #666;
        padding: 4px 0;
        border-top: 1px solid #eee;
        margin-top: 4px;
        font-style: italic;
      }

      .multi-select-summary.has-selections {
        color: var(--primary-dark);
        font-weight: 500;
      }

      .slider-container {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .slider {
        width: 100%;
        height: 4px;
        cursor: pointer;
        -webkit-appearance: none;
        appearance: none;
        background: #ddd;
        border-radius: 2px;
        outline: none;
      }

      .slider::-webkit-slider-track {
        width: 100%;
        height: 4px;
        background: #ddd;
        border-radius: 2px;
        border: none;
      }

      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        background: var(--primary-color);
        cursor: pointer;
        border-radius: 50%;
        margin-top: -7px;
        border: 2px solid white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      }

      .slider::-webkit-slider-thumb:hover {
        background: var(--primary-dark);
      }

      .slider::-moz-range-track {
        width: 100%;
        height: 4px;
        background: #ddd;
        border-radius: 2px;
      }

      .slider::-moz-range-thumb {
        width: 18px;
        height: 18px;
        background: var(--primary-color);
        cursor: pointer;
        border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      }

      .slider::-moz-range-thumb:hover {
        background: var(--primary-dark);
      }

      .slider::-ms-track {
        width: 100%;
        height: 4px;
        background: transparent;
        border-color: transparent;
        color: transparent;
      }

      .slider::-ms-fill-lower {
        background: #ddd;
        border-radius: 2px;
      }

      .slider::-ms-fill-upper {
        background: #ddd;
        border-radius: 2px;
      }

      .slider::-ms-thumb {
        width: 18px;
        height: 18px;
        background: var(--primary-color);
        cursor: pointer;
        border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      }

      .slider::-ms-thumb:hover {
        background: var(--primary-dark);
      }

      .slider-display {
        text-align: center;
        font-weight: bold;
        font-size: 14px;
        color: #333;
        background: #f8f9fa;
        padding: 6px 10px;
        border-radius: 4px;
        border: 1px solid #ddd;
      }
      .slider-display-input {
        width: 80%;
        font-weight: bold;
        font-size: 14px;
        color: #333;
        background: #f8f9fa;
        padding: 6px 10px;
        border-radius: 4px;
        border: 1px solid #f8f9fa;
        text-align: center;
        outline: none;
      }

      /* remove number spinners (Chrome, Edge) */
      .slider-display-input::-webkit-outer-spin-button,
      .slider-display-input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      /* remove number spinners (Firefox) */
      .slider-display-input[type="number"] {
        -moz-appearance: textfield;
      }
      /* Main content layout */
      .main-content-wrapper {
        display: flex;
        gap: 20px;
        margin-bottom: 0; /* Remove bottom margin since we're not stacking anymore */
        align-items: flex-start;
      }

      /* Stat cards container - now extends full height */
      .stats-cards-container {
        display: flex;
        flex-direction: column;
        width: 416px; /* 30% wider: 320px * 1.3 = 416px */
        min-width: 416px;
        height: calc(
          600px + 450px + 25px
        ); /* Map height + chart height + gap */
        gap: 15px;
      }

      /* Right content container for map and chart */
      .right-content-container {
        flex: 1;
        min-width: 0; /* Allow shrinking */
        display: flex;
        flex-direction: column;
        gap: 25px;
      }

      /* Individual stat card */
      .stat-card {
        background: white;
        padding: 16px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        flex: 1;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      .stat-card h3 {
        margin: 0 0 12px 0;
        color: #333;
        font-size: 16px; /* Increased from 15px */
        font-weight: 600;
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 6px;
        flex-shrink: 0;
      }

      .stat-card-content {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
        overflow-y: auto;
      }

      .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 0;
        border-bottom: 1px solid #eee;
      }

      .stat-item:last-child {
        border-bottom: none;
      }

      .stat-label {
        font-weight: 500;
        color: #555;
        font-size: 14px; /* Increased from 12px */
        flex: 1;
      }

      .stat-value {
        font-weight: 600;
        color: var(--primary-dark);
        font-size: 15px; /* Increased from 13px */
        text-align: right;
        margin-left: 8px;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        flex-wrap: wrap;
        gap: 2px;
      }

      .stat-value.large {
        font-size: 18px; /* Increased from 16px */
        color: var(--primary-color);
      }

      .comparison-item {
        display: flex;
        flex-direction: column;
        gap: 3px;
      }

      .comparison-label {
        font-size: 11px;
        color: #666;
        font-weight: 500;
      }

      .comparison-value {
        font-size: 15px; /* Increased from 13px */
        font-weight: 600;
      }

      .comparison-value.uk {
        color: var(--primary-color);
      }

      .comparison-value.global {
        color: #888;
      }

      .uk-comparison-value {
        color: var(--primary-color);
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .global-comparison-value {
        color: #888;
        font-weight: 500;
      }

      .comparison-percentage {
        font-size: 11px;
        color: #666;
        font-style: italic;
      }

      /* Stat card icons and trend indicators */
      .stat-icon {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
      }

      .stat-icon.abatement {
        background: #4caf50;
      }

      .stat-icon.cost {
        background: #2196f3;
      }

      .stat-icon.comparison {
        background: #ff9800;
      }

      .trend-indicator {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 11px;
        font-weight: 500;
        margin-left: 8px;
      }

      .trend-up {
        color: #4caf50;
      }

      .trend-down {
        color: #f44336;
      }

      .trend-up::before {
        content: "▲";
        font-size: 8px;
      }

      .trend-down::before {
        content: "▼";
        font-size: 8px;
      }

      /* Map container */
      .map-container {
        flex: 1;
        min-width: 0; /* Allow shrinking */
      }

      #plotDiv {
        width: 100%;
        height: 600px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      #routePlot {
        width: 100%;
        height: 450px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: visible !important;
      }

      /* Make the Plotly chart area have rounded corners */
      #routePlot .plot-container .plotly {
        border-radius: 8px;
        overflow: visible !important;
      }

      /* Ensure all child elements allow overflow */
      #routePlot .svg-container {
        overflow: visible !important;
      }

      #routePlot .main-svg {
        overflow: visible !important;
      }

      /* Responsive design */
      @media (max-width: 1200px) {
        .main-content-wrapper {
          flex-direction: column;
        }

        .stats-cards-container {
          width: 100%;
          height: auto; /* Reset height for horizontal layout */
          flex-direction: row;
          overflow-x: auto;
        }

        .stat-card {
          min-width: 380px;
          flex-shrink: 0;
        }

        .right-content-container {
          width: 100%;
        }

        .map-container {
          width: 100%;
        }
      }

      @media (max-width: 768px) {
        .stats-cards-container {
          flex-direction: column;
          height: auto; /* Reset height for mobile */
        }

        .stat-card {
          min-width: unset;
          width: 100%;
        }

        #plotDiv {
          height: 500px;
        }

        #routePlot {
          height: 400px !important;
        }
      }

      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        display: none;
      }

      .status.success {
        background: #e8f5ec;
        color: #2d5a3d;
        border: 1px solid var(--primary-light);
      }

      .status.error {
        background: #ffe8e6;
        color: #721c24;
        border: 1px solid #ffccc7;
      }

      .status.info {
        background: #e8f4f8;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .file-input {
        display: none;
      }

      .tab-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .tab-button {
        padding: 10px 20px;
        border: none;
        background: #e9ecef;
        cursor: pointer;
        border-radius: 4px;
        font-size: 14px;
        transition: all 0.3s;
        color: #495057;
      }

      .tab-button:hover {
        background: var(--primary-light);
        color: white;
      }

      .tab-button.active {
        background: var(--primary-color);
        color: white;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .no-data-message {
        text-align: center;
        padding: 40px;
        color: #666;
        font-size: 16px;
      }

      input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: var(--primary-color);
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border: 2px solid #ddd;
        border-radius: 3px;
        position: relative;
        background: white;
      }

      input[type="checkbox"]:checked {
        background: var(--primary-color);
        border-color: var(--primary-color);
      }

      input[type="checkbox"]:checked::after {
        content: "✓";
        position: absolute;
        color: white;
        font-size: 14px;
        font-weight: bold;
        top: -2px;
        left: 2px;
      }

      .drop-zone p:first-child {
        color: #333;
        font-weight: 500;
      }

      .header {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
      }

      .header h1 {
        margin: 0;
        color: #333;
        font-weight: 600;
        font-size: 24px;
      }

      .logo {
        height: 60px;
        width: auto;
        display: flex;
        align-items: center;
      }

      .logo img {
        height: 100%;
        width: auto;
        object-fit: contain;
      }
      .plotly .modebar {
        left: 1%;
        top: 1%;
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Contrail Avoidance</h1>
      <div class="logo">
        <img
          src="data:image/png;base64,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"
          alt="AIA Logo"
        />
      </div>
    </div>

    <div class="data-source-panel">
      <h2>Policy Options Dashboard</h2>
      <div class="tab-buttons">
        <button class="tab-button active" onclick="switchTab('csv')">
          Policy Option 1
        </button>
        <button class="tab-button" onclick="switchTab('db')">
          Policy Option 2
        </button>
        <button class="tab-button" onclick="switchTab('db')">
          Policy Option 3
        </button>
      </div>
      <div class="tab-button">
        <label for="hurdleSlider">
          <span class="tooltip"
            >Time Frame:
            <span
              tabindex="0"
              class="tooltip-icon"
              aria-hidden="false"
              aria-label="Info"
              >i
              <span class="tooltip-text small" role="tooltip"
                >Select the time frame used in analysis.</span
              >
            </span>
          </span>
        </label>
        <select id="timeSlider" onchange="updateMap()">
          <option value="HOURLY">Hourly</option>
          <option value="DAILY">Daily</option>
          <option value="MONTHLY">Monthly</option>
          <option value="SEASONALLY">Seasonally</option>
          <option value="ANNUALLY">Annually</option>
        </select>
        <label for="dateSelect">📅 Date:</label>
        <input
          type="date"
          id="dateSelect"
          min="2024-01-01"
          max="2024-12-31"
          value="2024-01-01"
        />
      </div>
    </div>

    <div id="plot-container" style="display: flex; flex-wrap: wrap;">
      <iframe
        src="plotly_analysis/plotly_plots/distance_flown_by_altitude_histogram.html"
        style="flex: 1 1 48%; min-width: 400px;"
        height="500px"
        frameborder="0"
      >
      </iframe>
      <iframe
        src="plotly_analysis/plotly_plots/distance_flown_by_altitude_histogram.html"
        style="flex: 1 1 48%; min-width: 400px;"
        height="500px"
        frameborder="0"
      ></iframe>
    </div>

    <div class="control-panel">
      <div class="control-group">
        <label for="fuelRoute">
          <span class="tooltip">
            Fuel Route:
            <span
              tabindex="0"
              class="tooltip-icon"
              aria-hidden="false"
              aria-label="Info"
              >i
              <span class="tooltip-text small" role="tooltip"
                >Select one or more fuel production pathways for sustainable
                aviation fuel (SAF).<br />
                Multiple selections will show weighted averages based on
                abatement potential.
              </span>
            </span>
          </span>
        </label>
        <div id="fuelRoute" class="multi-select-container">
          <div class="checkbox-item">
            <input
              type="checkbox"
              id="route-btl"
              value="btl"
              onchange="
                updateFuelRouteSummary();
                updateFeedstockOptions();
              "
              checked
            />
            <label for="route-btl">Biomass to Liquid</label>
          </div>
          <div class="checkbox-item">
            <input
              type="checkbox"
              id="route-atj"
              value="atj"
              onchange="
                updateFuelRouteSummary();
                updateFeedstockOptions();
              "
            />
            <label for="route-atj">Alcohol to Jet</label>
          </div>
          <div class="checkbox-item">
            <input
              type="checkbox"
              id="route-hefa"
              value="hefa"
              onchange="
                updateFuelRouteSummary();
                updateFeedstockOptions();
              "
            />
            <label for="route-hefa">HEFA</label>
          </div>
          <div class="checkbox-item">
            <input
              type="checkbox"
              id="route-p2l"
              value="p2l"
              onchange="
                updateFuelRouteSummary();
                updateFeedstockOptions();
              "
            />
            <label for="route-p2l">Power to Liquid</label>
          </div>
          <div class="multi-select-summary" id="fuelRoute-summary">
            1 route selected
          </div>
        </div>
      </div>
      <div class="control-group">
        <label for="feedstockGroup">
          <span class="tooltip">
            Feedstock Group:
            <span
              tabindex="0"
              class="tooltip-icon"
              aria-hidden="false"
              aria-label="Info"
              >i
              <span class="tooltip-text small" role="tooltip"
                >Select feedstock groups to quickly toggle all feedstocks in
                that group.<br />
                Selecting a group will check/uncheck all individual feedstocks
                in that category.
              </span>
            </span>
          </span>
        </label>
        <div id="feedstockGroup" class="multi-select-container">
          <div class="multi-select-summary" id="feedstockGroup-summary">
            0 groups selected
          </div>
        </div>
      </div>
      <div class="control-group">
        <label for="feedstock"
          ><span class="tooltip">
            Feedstock:
            <span
              tabindex="0"
              class="tooltip-icon"
              aria-hidden="false"
              aria-label="Info"
              >i
              <span class="tooltip-text small" role="tooltip"
                >Select individual feedstocks.<br />
                Multiple selections will show weighted averages based on
                abatement potential.</span
              >
            </span>
          </span></label
        >
        <div id="feedstock" class="multi-select-container">
          <div class="multi-select-summary" id="feedstock-summary">
            Loading...
          </div>
        </div>
      </div>

      <div class="control-group">
        <label for="yearSlider">
          <span class="tooltip">
            Year:
            <span
              tabindex="0"
              class="tooltip-icon"
              aria-hidden="false"
              aria-label="Info"
              >i
              <span class="tooltip-text small" role="tooltip"
                >Select the modeling year between 2025 and 2050.<br />Click the
                year display to type a value directly.</span
              >
            </span>
          </span>
        </label>
        <div class="slider-container">
          <input
            type="range"
            id="yearSlider"
            class="slider"
            min="2025"
            max="2050"
            value="2025"
            step="1"
            onchange="updateMap()"
            oninput="updateYearDisplay()"
          />
          <div
            id="yearDisplay"
            class="slider-display"
            onclick="enableYearEdit()"
          >
            2025
          </div>
        </div>
      </div>
      <div class="control-group">
        <label for="abatementSlider"
          ><span class="tooltip">
            Min Abatement Potential:
            <span
              tabindex="0"
              class="tooltip-icon"
              aria-hidden="false"
              aria-label="Info"
              >i
              <span class="tooltip-text small" role="tooltip"
                >Minimum abatement (in tonnes) required for a region/country to
                be shown on the map.<br />Click the abatement display to type a
                value directly.</span
              >
            </span>
          </span></label
        >
        <div class="slider-container">
          <input
            type="range"
            id="abatementSlider"
            class="slider"
            min="0"
            max="1000000"
            value="100"
            step="1000"
            onchange="updateMap()"
            oninput="updateAbatementDisplay()"
          />
          <div
            id="abatementDisplay"
            class="slider-display"
            onclick="enableAbatementEdit()"
          >
            100 t
          </div>
        </div>
      </div>
      <div class="control-group">
        <label for="constantScale">
          <span class="tooltip">
            Color Scale:
            <span
              tabindex="0"
              class="tooltip-icon"
              aria-hidden="false"
              aria-label="Info"
              >i
              <span class="tooltip-text small" role="tooltip"
                >Toggle between a constant display scale (£500/tonne -
                £9000/tonne) or a dynamic scale based on route/year.</span
              >
            </span>
          </span>
        </label>
        <div class="slider-container">
          <label
            style="
              font-weight: normal;
              display: flex;
              align-items: center;
              gap: 8px;
            "
          >
            <input type="checkbox" id="constantScale" onchange="updateMap()" />
            Constant scale
          </label>
        </div>
      </div>
      <div class="control-group">
        <label for="aggregateRegion">
          <span class="tooltip">
            Display:
            <span
              tabindex="0"
              class="tooltip-icon"
              aria-hidden="false"
              aria-label="Info"
              >i
              <span class="tooltip-text small" role="tooltip"
                >Choose whether to show individual countries or group them by
                continent.<br />
                Continental aggregation provides a higher-level regional view of
                SAF costs.</span
              >
            </span>
          </span>
        </label>
        <div class="slider-container">
          <label
            style="
              font-weight: normal;
              display: flex;
              align-items: center;
              gap: 8px;
            "
          >
            <input
              type="checkbox"
              id="aggregateRegion"
              onchange="updateMap()"
            />
            Aggregate by continent
          </label>
        </div>
      </div>
    </div>

    <div class="main-content-wrapper">
      <!-- Stat Cards -->
      <div class="stats-cards-container">
        <!-- Top 5 Countries by Abatement -->
        <div class="stat-card" style="flex-grow: 0.94">
          <div class="stat-icon abatement">🌱</div>
          <h3>Top 5 Countries by Abatement Potential</h3>
          <div class="stat-card-content" id="top-abatement-content">
            <div class="stat-item">
              <span class="stat-label">No data available</span>
            </div>
          </div>
        </div>

        <!-- Top 5 Countries by Cheapest Cost -->
        <div class="stat-card" style="flex-grow: 0.94">
          <div class="stat-icon cost">💰</div>
          <h3>Top 5 Countries by Lowest SAF Cost</h3>
          <div class="stat-card-content" id="top-cost-content">
            <div class="stat-item">
              <span class="stat-label">No data available</span>
            </div>
          </div>
        </div>

        <!-- UK Comparison -->
        <div class="stat-card" style="flex-grow: 1.12">
          <div class="stat-icon comparison">📊</div>
          <h3>UK vs Global Comparison</h3>
          <div class="stat-card-content" id="uk-comparison-content">
            <div class="stat-item">
              <span class="stat-label">No data available</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Content Container -->
      <div class="right-content-container">
        <!-- Map Container -->
        <div class="map-container">
          <div id="plotDiv">
            <div class="no-data-message">
              <p><strong>No data loaded</strong></p>
              <p>
                Please load a SQLite database or CSV file to view the choropleth
                map.
              </p>
            </div>
          </div>
        </div>

        <!-- Line Chart Container -->
        <div id="routePlot"></div>
      </div>
    </div>

    <script>
      let savedView = {};
      let currentData = {};
      let currentDataSource = "none";
      let countryMapping = {};

      const AGRICULTURAL_RESIDUES = new Set([
        "BARLEY_STRAW",
        "COCONUT_HUSKS",
        "COCONUT_SHELLS",
        "CORN_STOVER",
        "COTTON_STALKS",
        "DRY_BEAN_STRAW",
        "GROUNDNUT_HAULMS",
        "GROUNDNUT_SHELLS",
        "MILLET_STRAW",
        "OAT_STRAW",
        "OIL_PALM_SHELLS",
        "ONION_RESIDUES",
        "POTATO_RESIDUES",
        "RAPESEED_STRAW",
        "RICE_STRAW",
        "RYE_STRAW",
        "SESAME_STALKS",
        "SORGHUM_STRAW",
        "SOYA_BEAN_STRAW",
        "SUNFLOWER_STALKS",
        "TOMATO_BRANCHES",
        "TRITICALE_STRAW",
        "WHEAT_STRAW",
      ]);

      const SUGARY_RESIDUES = new Set([
        "SUGARCANE_BAGASSE",
        "SUGARCANE_TRASH",
        "SUGAR_BEET_PULP",
      ]);

      const CARBON_DIOXIDE = new Set([
        "DIRECT_AIR_CAPTURE",
        "POINT_SOURCE_CARBON",
        "BIOGENIC_CARBON",
      ]);

      const POWER_TO_LIQUID = new Set([
        "DIRECT_AIR_CAPTURE",
        "POINT_SOURCE_CARBON",
        "BIOGENIC_CARBON",
      ]);

      const FORESTRY_RESIDUES_ALL = new Set([
        "FORESTRY_RESIDUES",
        "WASTE_WOOD",
        "WOOD_CHIPS",
      ]);

      const MUNICIPAL_SOLID_WASTE_ALL = new Set(["MUNICIPAL_SOLID_WASTE"]);

      const BIOMASS_TO_LIQUID_SINGULAR_FEEDSTOCKS = new Set([
        ...Array.from(AGRICULTURAL_RESIDUES),
        ...Array.from(FORESTRY_RESIDUES_ALL),
        ...Array.from(MUNICIPAL_SOLID_WASTE_ALL),
      ]);

      const GROUP_FEEDSTOCKS = new Set([
        "AGRICULTURAL_RESIDUES",
        "FORESTRY_RESIDUES_ALL",
        "SUGARY_RESIDUES",
        "CARBON_DIOXIDE",
        "FATS_AND_OILS",
        "MUNICIPAL_SOLID_WASTE_ALL",
      ]);
      const COLORBAR_LABEL = "USD2024/tonne";

      const ISO3_TO_CONTINENT = {
        DZA: "Africa",
        AGO: "Africa",
        BEN: "Africa",
        BWA: "Africa",
        BFA: "Africa",
        BDI: "Africa",
        CMR: "Africa",
        CPV: "Africa",
        CAF: "Africa",
        TCD: "Africa",
        COM: "Africa",
        COG: "Africa",
        COD: "Africa",
        CIV: "Africa",
        DJI: "Africa",
        EGY: "Africa",
        GNQ: "Africa",
        ERI: "Africa",
        SWZ: "Africa",
        ETH: "Africa",
        GAB: "Africa",
        GMB: "Africa",
        GHA: "Africa",
        GIN: "Africa",
        GNB: "Africa",
        KEN: "Africa",
        LSO: "Africa",
        LBR: "Africa",
        LBY: "Africa",
        MDG: "Africa",
        MWI: "Africa",
        MLI: "Africa",
        MRT: "Africa",
        MUS: "Africa",
        MAR: "Africa",
        MOZ: "Africa",
        NAM: "Africa",
        NER: "Africa",
        NGA: "Africa",
        RWA: "Africa",
        STP: "Africa",
        SEN: "Africa",
        SYC: "Africa",
        SLE: "Africa",
        SOM: "Africa",
        ZAF: "Africa",
        SSD: "Africa",
        SDN: "Africa",
        TZA: "Africa",
        TGO: "Africa",
        TUN: "Africa",
        UGA: "Africa",
        ZMB: "Africa",
        ZWE: "Africa",
        AFG: "Asia",
        ARM: "Asia",
        AZE: "Asia",
        BHR: "Asia",
        BGD: "Asia",
        BTN: "Asia",
        BRN: "Asia",
        KHM: "Asia",
        CHN: "Asia",
        GEO: "Asia",
        IND: "Asia",
        IDN: "Asia",
        IRN: "Asia",
        IRQ: "Asia",
        ISR: "Asia",
        JPN: "Asia",
        JOR: "Asia",
        KAZ: "Asia",
        KWT: "Asia",
        KGZ: "Asia",
        LAO: "Asia",
        LBN: "Asia",
        MYS: "Asia",
        MDV: "Asia",
        MNG: "Asia",
        MMR: "Asia",
        NPL: "Asia",
        PRK: "Asia",
        OMN: "Asia",
        PAK: "Asia",
        PSE: "Asia",
        PHL: "Asia",
        QAT: "Asia",
        SAU: "Asia",
        SGP: "Asia",
        KOR: "Asia",
        LKA: "Asia",
        SYR: "Asia",
        TWN: "Asia",
        TJK: "Asia",
        THA: "Asia",
        TLS: "Asia",
        TUR: "Asia",
        TKM: "Asia",
        ARE: "Asia",
        UZB: "Asia",
        VNM: "Asia",
        YEM: "Asia",
        MAC: "Asia",
        ALB: "Europe",
        AND: "Europe",
        AUT: "Europe",
        BLR: "Europe",
        BEL: "Europe",
        BIH: "Europe",
        BGR: "Europe",
        HRV: "Europe",
        CYP: "Europe",
        CZE: "Europe",
        DNK: "Europe",
        EST: "Europe",
        FIN: "Europe",
        FRA: "Europe",
        DEU: "Europe",
        GRC: "Europe",
        HUN: "Europe",
        ISL: "Europe",
        IRL: "Europe",
        ITA: "Europe",
        XKX: "Europe",
        LVA: "Europe",
        LIE: "Europe",
        LTU: "Europe",
        LUX: "Europe",
        MLT: "Europe",
        MDA: "Europe",
        MCO: "Europe",
        MNE: "Europe",
        NLD: "Europe",
        MKD: "Europe",
        NOR: "Europe",
        POL: "Europe",
        PRT: "Europe",
        ROU: "Europe",
        RUS: "Europe",
        SMR: "Europe",
        SRB: "Europe",
        SVK: "Europe",
        SVN: "Europe",
        ESP: "Europe",
        SWE: "Europe",
        CHE: "Europe",
        UKR: "Europe",
        GBR: "Europe",
        VAT: "Europe",
        ATG: "North America",
        BHS: "North America",
        BRB: "North America",
        BLZ: "North America",
        CAN: "North America",
        CRI: "North America",
        CUB: "North America",
        DMA: "North America",
        DOM: "North America",
        SLV: "North America",
        GRD: "North America",
        GTM: "North America",
        HTI: "North America",
        HND: "North America",
        JAM: "North America",
        MEX: "North America",
        NIC: "North America",
        PAN: "North America",
        KNA: "North America",
        LCA: "North America",
        VCT: "North America",
        TTO: "North America",
        USA: "North America",
        ARG: "South America",
        BOL: "South America",
        BRA: "South America",
        CHL: "South America",
        COL: "South America",
        ECU: "South America",
        GUY: "South America",
        PRY: "South America",
        PER: "South America",
        SUR: "South America",
        URY: "South America",
        VEN: "South America",
        AUS: "Oceania",
        FJI: "Oceania",
        KIR: "Oceania",
        MHL: "Oceania",
        FSM: "Oceania",
        NRU: "Oceania",
        NZL: "Oceania",
        PLW: "Oceania",
        PNG: "Oceania",
        WSM: "Oceania",
        SLB: "Oceania",
        TON: "Oceania",
        TUV: "Oceania",
        VUT: "Oceania",
        NCL: "Oceania",
        PYF: "Oceania",
        NIU: "Oceania",
        PRI: "North America",
      };

      let SQL;

      // Initialize SQL.js when the page loads
      async function initializeSQLJS() {
        try {
          if (!SQL) {
            console.log("Initializing SQL.js...");
            SQL = await initSqlJs({
              locateFile: (file) => {
                console.log(`Loading SQL.js file: ${file}`);
                return `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/${file}`;
              },
            });
            console.log("SQL.js initialized successfully");
          }
        } catch (error) {
          console.error("Failed to initialize SQL.js:", error);
          showStatus(`Failed to initialize SQL.js: ${error.message}`, "error");
        }
      }

      // Initialize SQL.js on page load
      initializeSQLJS();

      // M49 code to ISO3 mapping
      const M49_TO_ISO3 = {
        12: "DZA",
        818: "EGY",
        434: "LBY",
        504: "MAR",
        729: "SDN",
        788: "TUN",
        732: "ESH",
        108: "BDI",
        174: "COM",
        262: "DJI",
        232: "ERI",
        231: "ETH",
        404: "KEN",
        450: "MDG",
        454: "MWI",
        480: "MUS",
        508: "MOZ",
        646: "RWA",
        690: "SYC",
        706: "SOM",
        728: "SSD",
        800: "UGA",
        834: "TZA",
        894: "ZMB",
        716: "ZWE",
        24: "AGO",
        120: "CMR",
        140: "CAF",
        148: "TCD",
        178: "COG",
        180: "COD",
        226: "GNQ",
        266: "GAB",
        678: "STP",
        72: "BWA",
        748: "SWZ",
        426: "LSO",
        516: "NAM",
        710: "ZAF",
        204: "BEN",
        854: "BFA",
        132: "CPV",
        384: "CIV",
        270: "GMB",
        288: "GHA",
        324: "GIN",
        624: "GNB",
        430: "LBR",
        466: "MLI",
        478: "MRT",
        562: "NER",
        566: "NGA",
        686: "SEN",
        694: "SLE",
        768: "TGO",
        28: "ATG",
        44: "BHS",
        52: "BRB",
        192: "CUB",
        212: "DMA",
        214: "DOM",
        308: "GRD",
        332: "HTI",
        388: "JAM",
        659: "KNA",
        662: "LCA",
        670: "VCT",
        780: "TTO",
        84: "BLZ",
        188: "CRI",
        222: "SLV",
        320: "GTM",
        340: "HND",
        484: "MEX",
        558: "NIC",
        591: "PAN",
        32: "ARG",
        68: "BOL",
        76: "BRA",
        152: "CHL",
        170: "COL",
        218: "ECU",
        328: "GUY",
        600: "PRY",
        604: "PER",
        740: "SUR",
        858: "URY",
        862: "VEN",
        124: "CAN",
        840: "USA",
        398: "KAZ",
        417: "KGZ",
        762: "TJK",
        795: "TKM",
        860: "UZB",
        156: "CHN",
        344: "HKG",
        446: "MAC",
        408: "PRK",
        392: "JPN",
        496: "MNG",
        410: "KOR",
        96: "BRN",
        116: "KHM",
        360: "IDN",
        418: "LAO",
        458: "MYS",
        104: "MMR",
        608: "PHL",
        702: "SGP",
        764: "THA",
        626: "TLS",
        704: "VNM",
        4: "AFG",
        50: "BGD",
        64: "BTN",
        356: "IND",
        364: "IRN",
        462: "MDV",
        524: "NPL",
        586: "PAK",
        144: "LKA",
        51: "ARM",
        31: "AZE",
        48: "BHR",
        196: "CYP",
        268: "GEO",
        368: "IRQ",
        376: "ISR",
        400: "JOR",
        414: "KWT",
        422: "LBN",
        512: "OMN",
        634: "QAT",
        682: "SAU",
        275: "PSE",
        760: "SYR",
        792: "TUR",
        784: "ARE",
        887: "YEM",
        112: "BLR",
        100: "BGR",
        203: "CZE",
        348: "HUN",
        616: "POL",
        498: "MDA",
        642: "ROU",
        643: "RUS",
        703: "SVK",
        804: "UKR",
        208: "DNK",
        233: "EST",
        246: "FIN",
        352: "ISL",
        372: "IRL",
        428: "LVA",
        440: "LTU",
        578: "NOR",
        752: "SWE",
        826: "GBR",
        8: "ALB",
        20: "AND",
        70: "BIH",
        191: "HRV",
        300: "GRC",
        336: "VAT",
        380: "ITA",
        470: "MLT",
        499: "MNE",
        807: "MKD",
        620: "PRT",
        674: "SMR",
        688: "SRB",
        705: "SVN",
        724: "ESP",
        40: "AUT",
        56: "BEL",
        250: "FRA",
        276: "DEU",
        438: "LIE",
        442: "LUX",
        492: "MCO",
        528: "NLD",
        756: "CHE",
        36: "AUS",
        554: "NZL",
        242: "FJI",
        540: "NCL",
        598: "PNG",
        90: "SLB",
        548: "VUT",
        296: "KIR",
        584: "MHL",
        583: "FSM",
        520: "NRU",
        585: "PLW",
        258: "PYF",
        570: "NIU",
        882: "WSM",
        776: "TON",
        798: "TUV",
        630: "PRI",
      };

      // M49 regional codes to list of ISO3 country codes
      const M49_REGION_TO_ISO3 = {
        // Northern Africa
        15: ["DZA", "EGY", "LBY", "MAR", "SDN", "TUN", "ESH"],
        // Eastern Africa
        14: [
          "BDI",
          "COM",
          "DJI",
          "ERI",
          "ETH",
          "KEN",
          "MDG",
          "MWI",
          "MUS",
          "MOZ",
          "RWA",
          "SYC",
          "SOM",
          "SSD",
          "UGA",
          "TZA",
          "ZMB",
          "ZWE",
        ],
        // Middle Africa
        17: ["AGO", "CMR", "CAF", "TCD", "COG", "COD", "GNQ", "GAB", "STP"],
        // Southern Africa
        18: ["BWA", "SWZ", "LSO", "NAM", "ZAF"],
        // Western Africa
        11: [
          "BEN",
          "BFA",
          "CPV",
          "CIV",
          "GMB",
          "GHA",
          "GIN",
          "GNB",
          "LBR",
          "MLI",
          "MRT",
          "NER",
          "NGA",
          "SEN",
          "SLE",
          "TGO",
        ],
        // Sub-Saharan Africa
        202: [
          "AGO",
          "BEN",
          "BWA",
          "BFA",
          "BDI",
          "CMR",
          "CPV",
          "CAF",
          "TCD",
          "COM",
          "COG",
          "COD",
          "CIV",
          "DJI",
          "GNQ",
          "ERI",
          "SWZ",
          "ETH",
          "GAB",
          "GMB",
          "GHA",
          "GIN",
          "GNB",
          "KEN",
          "LSO",
          "LBR",
          "MDG",
          "MWI",
          "MLI",
          "MRT",
          "MUS",
          "MOZ",
          "NAM",
          "NER",
          "NGA",
          "RWA",
          "STP",
          "SEN",
          "SYC",
          "SLE",
          "SOM",
          "ZAF",
          "SSD",
          "SDN",
          "TZA",
          "TGO",
          "UGA",
          "ZMB",
          "ZWE",
        ],
        // Africa
        2: [
          "DZA",
          "AGO",
          "BEN",
          "BWA",
          "BFA",
          "BDI",
          "CMR",
          "CPV",
          "CAF",
          "TCD",
          "COM",
          "COG",
          "COD",
          "CIV",
          "DJI",
          "EGY",
          "GNQ",
          "ERI",
          "SWZ",
          "ETH",
          "GAB",
          "GMB",
          "GHA",
          "GIN",
          "GNB",
          "KEN",
          "LSO",
          "LBR",
          "LBY",
          "MDG",
          "MWI",
          "MLI",
          "MAR",
          "MRT",
          "MUS",
          "MOZ",
          "NAM",
          "NER",
          "NGA",
          "RWA",
          "STP",
          "SEN",
          "SYC",
          "SLE",
          "SOM",
          "ZAF",
          "SSD",
          "SDN",
          "TZA",
          "TGO",
          "TUN",
          "UGA",
          "ESH",
          "ZMB",
          "ZWE",
        ],
        // Caribbean
        29: [
          "ATG",
          "BHS",
          "BRB",
          "CUB",
          "DMA",
          "DOM",
          "GRD",
          "HTI",
          "JAM",
          "KNA",
          "LCA",
          "VCT",
          "TTO",
        ],
        // Central America
        13: ["BLZ", "CRI", "SLV", "GTM", "HND", "MEX", "NIC", "PAN"],
        // South America
        5: [
          "ARG",
          "BOL",
          "BRA",
          "CHL",
          "COL",
          "ECU",
          "GUY",
          "PRY",
          "PER",
          "SUR",
          "URY",
          "VEN",
        ],
        // Northern America
        21: ["CAN", "USA"],
        // Latin America and the Caribbean
        419: [
          "ARG",
          "BOL",
          "BRA",
          "CHL",
          "COL",
          "ECU",
          "GUY",
          "PRY",
          "PER",
          "SUR",
          "URY",
          "VEN",
          "BLZ",
          "CRI",
          "SLV",
          "GTM",
          "HND",
          "MEX",
          "NIC",
          "PAN",
          "ATG",
          "BHS",
          "BRB",
          "CUB",
          "DMA",
          "DOM",
          "GRD",
          "HTI",
          "JAM",
          "KNA",
          "LCA",
          "VCT",
          "TTO",
        ],
        // Americas
        19: [
          "CAN",
          "USA",
          "ARG",
          "BOL",
          "BRA",
          "CHL",
          "COL",
          "ECU",
          "GUY",
          "PRY",
          "PER",
          "SUR",
          "URY",
          "VEN",
          "BLZ",
          "CRI",
          "SLV",
          "GTM",
          "HND",
          "MEX",
          "NIC",
          "PAN",
          "ATG",
          "BHS",
          "BRB",
          "CUB",
          "DMA",
          "DOM",
          "GRD",
          "HTI",
          "JAM",
          "KNA",
          "LCA",
          "VCT",
          "TTO",
        ],
        // Central Asia
        143: ["KAZ", "KGZ", "TJK", "TKM", "UZB"],
        // Eastern Asia
        30: ["CHN", "HKG", "MAC", "PRK", "JPN", "MNG", "KOR"],
        // South-Eastern Asia
        35: [
          "BRN",
          "KHM",
          "IDN",
          "LAO",
          "MYS",
          "MMR",
          "PHL",
          "SGP",
          "THA",
          "TLS",
          "VNM",
        ],
        // Southern Asia
        34: ["AFG", "BGD", "BTN", "IND", "IRN", "MDV", "NPL", "PAK", "LKA"],
        // Western Asia
        145: [
          "ARM",
          "AZE",
          "BHR",
          "CYP",
          "GEO",
          "IRQ",
          "ISR",
          "JOR",
          "KWT",
          "LBN",
          "OMN",
          "QAT",
          "SAU",
          "PSE",
          "SYR",
          "TUR",
          "ARE",
          "YEM",
        ],
        // Asia
        142: [
          "AFG",
          "ARM",
          "AZE",
          "BHR",
          "BGD",
          "BTN",
          "BRN",
          "KHM",
          "CHN",
          "CYP",
          "GEO",
          "HKG",
          "IND",
          "IDN",
          "IRN",
          "IRQ",
          "ISR",
          "JPN",
          "JOR",
          "KAZ",
          "KWT",
          "KGZ",
          "LAO",
          "LBN",
          "MAC",
          "MYS",
          "MDV",
          "MNG",
          "MMR",
          "NPL",
          "PRK",
          "OMN",
          "PAK",
          "PSE",
          "PHL",
          "QAT",
          "SAU",
          "SGP",
          "KOR",
          "LKA",
          "SYR",
          "TJK",
          "THA",
          "TLS",
          "TUR",
          "TKM",
          "ARE",
          "UZB",
          "VNM",
          "YEM",
        ],
        // Eastern Europe
        151: [
          "BLR",
          "BGR",
          "CZE",
          "HUN",
          "POL",
          "MDA",
          "ROU",
          "RUS",
          "SVK",
          "UKR",
        ],
        // Northern Europe
        154: [
          "DNK",
          "EST",
          "FIN",
          "ISL",
          "IRL",
          "LVA",
          "LTU",
          "NOR",
          "SWE",
          "GBR",
        ],
        // Southern Europe
        39: [
          "ALB",
          "AND",
          "BIH",
          "HRV",
          "GRC",
          "VAT",
          "ITA",
          "MLT",
          "MNE",
          "MKD",
          "PRT",
          "SMR",
          "SRB",
          "SVN",
          "ESP",
        ],
        // Western Europe
        155: ["AUT", "BEL", "FRA", "DEU", "LIE", "LUX", "MCO", "NLD", "CHE"],
        // Europe
        150: [
          "ALB",
          "AND",
          "AUT",
          "BLR",
          "BEL",
          "BIH",
          "BGR",
          "HRV",
          "CYP",
          "CZE",
          "DNK",
          "EST",
          "FIN",
          "FRA",
          "DEU",
          "GRC",
          "VAT",
          "HUN",
          "ISL",
          "IRL",
          "ITA",
          "LVA",
          "LIE",
          "LTU",
          "LUX",
          "MLT",
          "MDA",
          "MCO",
          "MNE",
          "NLD",
          "MKD",
          "NOR",
          "POL",
          "PRT",
          "ROU",
          "RUS",
          "SMR",
          "SRB",
          "SVK",
          "SVN",
          "ESP",
          "SWE",
          "CHE",
          "UKR",
          "GBR",
        ],
        // Australia and New Zealand
        53: ["AUS", "NZL"],
        // Melanesia
        54: ["FJI", "NCL", "PNG", "SLB", "VUT"],
        // Micronesia
        57: ["KIR", "MHL", "FSM", "NRU", "PLW"],
        // Polynesia
        61: ["PYF", "NIU", "WSM", "TON", "TUV"],
        // Oceania
        9: [
          "AUS",
          "FJI",
          "KIR",
          "MHL",
          "FSM",
          "NRU",
          "NZL",
          "PLW",
          "PNG",
          "SLB",
          "VUT",
          "PYF",
          "NIU",
          "WSM",
          "TON",
          "TUV",
          "NCL",
        ],
      };

      // ISO3 to country name mapping for display
      const ISO3_TO_NAME = {
        AFG: "Afghanistan",
        ALB: "Albania",
        DZA: "Algeria",
        AGO: "Angola",
        ATG: "Antigua and Barbuda",
        ARG: "Argentina",
        ARM: "Armenia",
        AUS: "Australia",
        AUT: "Austria",
        AZE: "Azerbaijan",
        BHS: "Bahamas",
        BHR: "Bahrain",
        BGD: "Bangladesh",
        BRB: "Barbados",
        BLR: "Belarus",
        BEL: "Belgium",
        BLZ: "Belize",
        BEN: "Benin",
        BTN: "Bhutan",
        BOL: "Bolivia",
        BIH: "Bosnia and Herzegovina",
        BWA: "Botswana",
        BRA: "Brazil",
        BRN: "Brunei",
        BGR: "Bulgaria",
        BFA: "Burkina Faso",
        BDI: "Burundi",
        CPV: "Cabo Verde",
        KHM: "Cambodia",
        CMR: "Cameroon",
        CAN: "Canada",
        CAF: "Central African Republic",
        TCD: "Chad",
        CHL: "Chile",
        CHN: "China",
        MAC: "Macao",
        TWN: "Taiwan",
        COL: "Colombia",
        COM: "Comoros",
        COG: "Congo",
        CRI: "Costa Rica",
        CIV: "Côte d'Ivoire",
        HRV: "Croatia",
        CUB: "Cuba",
        CYP: "Cyprus",
        CZE: "Czechia",
        COD: "DR Congo",
        DNK: "Denmark",
        DJI: "Djibouti",
        DMA: "Dominica",
        DOM: "Dominican Republic",
        ECU: "Ecuador",
        EGY: "Egypt",
        SLV: "El Salvador",
        GNQ: "Equatorial Guinea",
        ERI: "Eritrea",
        EST: "Estonia",
        SWZ: "Eswatini",
        ETH: "Ethiopia",
        FJI: "Fiji",
        FIN: "Finland",
        FRA: "France",
        PYF: "French Polynesia",
        GAB: "Gabon",
        GMB: "Gambia",
        GEO: "Georgia",
        DEU: "Germany",
        GHA: "Ghana",
        GRC: "Greece",
        GRD: "Grenada",
        GTM: "Guatemala",
        GIN: "Guinea",
        GNB: "Guinea-Bissau",
        GUY: "Guyana",
        HTI: "Haiti",
        HND: "Honduras",
        HUN: "Hungary",
        ISL: "Iceland",
        IND: "India",
        IDN: "Indonesia",
        IRN: "Iran",
        IRQ: "Iraq",
        IRL: "Ireland",
        ISR: "Israel",
        ITA: "Italy",
        JAM: "Jamaica",
        JPN: "Japan",
        JOR: "Jordan",
        KAZ: "Kazakhstan",
        KEN: "Kenya",
        KIR: "Kiribati",
        KWT: "Kuwait",
        KGZ: "Kyrgyzstan",
        LAO: "Laos",
        LVA: "Latvia",
        LBN: "Lebanon",
        LSO: "Lesotho",
        LBR: "Liberia",
        LBY: "Libya",
        LTU: "Lithuania",
        LUX: "Luxembourg",
        MDG: "Madagascar",
        MWI: "Malawi",
        MYS: "Malaysia",
        MDV: "Maldives",
        MLI: "Mali",
        MLT: "Malta",
        MHL: "Marshall Islands",
        MRT: "Mauritania",
        MUS: "Mauritius",
        MEX: "Mexico",
        FSM: "Micronesia",
        MDA: "Moldova",
        MCO: "Monaco",
        MNG: "Mongolia",
        MNE: "Montenegro",
        MAR: "Morocco",
        MOZ: "Mozambique",
        MMR: "Myanmar",
        NAM: "Namibia",
        NRU: "Nauru",
        NPL: "Nepal",
        NLD: "Netherlands",
        NCL: "New Caledonia",
        NZL: "New Zealand",
        NIC: "Nicaragua",
        NER: "Niger",
        NGA: "Nigeria",
        NIU: "Niue",
        MKD: "North Macedonia",
        PRK: "North Korea",
        NOR: "Norway",
        OMN: "Oman",
        PAK: "Pakistan",
        PLW: "Palau",
        PSE: "Palestine",
        PAN: "Panama",
        PNG: "Papua New Guinea",
        PRY: "Paraguay",
        PER: "Peru",
        PHL: "Philippines",
        POL: "Poland",
        PRT: "Portugal",
        PRI: "Puerto Rico",
        QAT: "Qatar",
        KOR: "South Korea",
        ROU: "Romania",
        RUS: "Russia",
        RWA: "Rwanda",
        KNA: "Saint Kitts and Nevis",
        LCA: "Saint Lucia",
        VCT: "Saint Vincent and the Grenadines",
        WSM: "Samoa",
        STP: "São Tomé and Príncipe",
        SAU: "Saudi Arabia",
        SEN: "Senegal",
        SRB: "Serbia",
        SYC: "Seychelles",
        SLE: "Sierra Leone",
        SGP: "Singapore",
        SVK: "Slovakia",
        SVN: "Slovenia",
        SLB: "Solomon Islands",
        SOM: "Somalia",
        ZAF: "South Africa",
        SSD: "South Sudan",
        ESP: "Spain",
        LKA: "Sri Lanka",
        SDN: "Sudan",
        SUR: "Suriname",
        SWE: "Sweden",
        CHE: "Switzerland",
        SYR: "Syria",
        TJK: "Tajikistan",
        TZA: "Tanzania",
        THA: "Thailand",
        TLS: "Timor-Leste",
        TGO: "Togo",
        TON: "Tonga",
        TTO: "Trinidad and Tobago",
        TUN: "Tunisia",
        TUR: "Turkey",
        TKM: "Turkmenistan",
        TUV: "Tuvalu",
        UGA: "Uganda",
        UKR: "Ukraine",
        ARE: "United Arab Emirates",
        GBR: "United Kingdom",
        USA: "United States",
        URY: "Uruguay",
        UZB: "Uzbekistan",
        VUT: "Vanuatu",
        VEN: "Venezuela",
        VNM: "Vietnam",
        YEM: "Yemen",
        ZMB: "Zambia",
        ZWE: "Zimbabwe",
        ESH: "Western Sahara",
        HKG: "Hong Kong",
        VAT: "Vatican City",
        LIE: "Liechtenstein",
        AND: "Andorra",
        SMR: "San Marino",
      };

      countryMapping = {
        AFGHANISTAN: "AFG",
        ALBANIA: "ALB",
        ALGERIA: "DZA",
        ANGOLA: "AGO",
        "ANTIGUA AND BARBUDA": "ATG",
        ARGENTINA: "ARG",
        ARMENIA: "ARM",
        AUSTRALIA: "AUS",
        AUSTRIA: "AUT",
        AZERBAIJAN: "AZE",
        BAHAMAS: "BHS",
        BAHRAIN: "BHR",
        BANGLADESH: "BGD",
        BARBADOS: "BRB",
        BELARUS: "BLR",
        BELGIUM: "BEL",
        BELIZE: "BLZ",
        BENIN: "BEN",
        BHUTAN: "BTN",
        BOLIVIA: "BOL",
        "BOSNIA AND HERZEGOVINA": "BIH",
        BOTSWANA: "BWA",
        BRAZIL: "BRA",
        BRUNEI: "BRN",
        BULGARIA: "BGR",
        "BURKINA FASO": "BFA",
        BURUNDI: "BDI",
        "CABO VERDE": "CPV",
        CAMBODIA: "KHM",
        CAMEROON: "CMR",
        CANADA: "CAN",
        "CENTRAL AFRICAN REPUBLIC": "CAF",
        CHAD: "TCD",
        CHILE: "CHL",
        "CHINA MAINLAND": "CHN",
        "CHINA MACAO": "MAC",
        "CHINA TAIWAN": "TWN",
        COLOMBIA: "COL",
        COMOROS: "COM",
        CONGO: "COG",
        "COSTA RICA": "CRI",
        "COTE DIVOIRE": "CIV",
        CROATIA: "HRV",
        CUBA: "CUB",
        CYPRUS: "CYP",
        CZECHIA: "CZE",
        "DEMOCRATIC REPUBLIC OF THE CONGO": "COD",
        DENMARK: "DNK",
        DJIBOUTI: "DJI",
        DOMINICA: "DMA",
        "DOMINICAN REPUBLIC": "DOM",
        ECUADOR: "ECU",
        EGYPT: "EGY",
        "EL SALVADOR": "SLV",
        "EQUATORIAL GUINEA": "GNQ",
        ERITREA: "ERI",
        ESTONIA: "EST",
        ESWATINI: "SWZ",
        ETHIOPIA: "ETH",
        FIJI: "FJI",
        FINLAND: "FIN",
        FRANCE: "FRA",
        "FRENCH POLYNESIA": "PYF",
        GABON: "GAB",
        GAMBIA: "GMB",
        GEORGIA: "GEO",
        GERMANY: "DEU",
        GHANA: "GHA",
        GREECE: "GRC",
        GRENADA: "GRD",
        GUATEMALA: "GTM",
        GUINEA: "GIN",
        "GUINEA BISSAU": "GNB",
        GUYANA: "GUY",
        HAITI: "HTI",
        HONDURAS: "HND",
        HUNGARY: "HUN",
        ICELAND: "ISL",
        INDIA: "IND",
        INDONESIA: "IDN",
        IRAN: "IRN",
        IRAQ: "IRQ",
        IRELAND: "IRL",
        ISRAEL: "ISR",
        ITALY: "ITA",
        JAMAICA: "JAM",
        JAPAN: "JPN",
        JORDAN: "JOR",
        KAZAKHSTAN: "KAZ",
        KENYA: "KEN",
        KIRIBATI: "KIR",
        KUWAIT: "KWT",
        KYRGYZSTAN: "KGZ",
        LAO: "LAO",
        LATVIA: "LVA",
        LEBANON: "LBN",
        LESOTHO: "LSO",
        LIBERIA: "LBR",
        LIBYA: "LBY",
        LITHUANIA: "LTU",
        LUXEMBOURG: "LUX",
        MADAGASCAR: "MDG",
        MALAWI: "MWI",
        MALAYSIA: "MYS",
        MALDIVES: "MDV",
        MALI: "MLI",
        MALTA: "MLT",
        "MARSHALL ISLANDS": "MHL",
        MAURITANIA: "MRT",
        MAURITIUS: "MUS",
        MEXICO: "MEX",
        MICRONESIA: "FSM",
        MOLDOVA: "MDA",
        MONACO: "MCO",
        MONGOLIA: "MNG",
        MONTENEGRO: "MNE",
        MOROCCO: "MAR",
        MOZAMBIQUE: "MOZ",
        MYANMAR: "MMR",
        NAMIBIA: "NAM",
        NAURU: "NRU",
        NEPAL: "NPL",
        NETHERLANDS: "NLD",
        "NEW CALEDONIA": "NCL",
        "NEW ZEALAND": "NZL",
        NICARAGUA: "NIC",
        NIGER: "NER",
        NIGERIA: "NGA",
        NIUE: "NIU",
        "NORTH MACEDONIA": "MKD",
        "NORTH KOREA": "PRK",
        NORWAY: "NOR",
        OMAN: "OMN",
        PAKISTAN: "PAK",
        PALAU: "PLW",
        PALESTINE: "PSE",
        PANAMA: "PAN",
        "PAPUA NEW GUINEA": "PNG",
        PARAGUAY: "PRY",
        PERU: "PER",
        PHILIPPINES: "PHL",
        POLAND: "POL",
        PORTUGAL: "PRT",
        "PUERTO RICO": "PRI",
        QATAR: "QAT",
        "SOUTH KOREA": "KOR",
        ROMANIA: "ROU",
        RUSSIA: "RUS",
        RWANDA: "RWA",
        "SAINT KITTS AND NEVIS": "KNA",
        "SAINT LUCIA": "LCA",
        "SAINT VINCENT AND THE GRENADINES": "VCT",
        SAMOA: "WSM",
        "SAO TOME AND PRINCIPE": "STP",
        "SAUDI ARABIA": "SAU",
        SENEGAL: "SEN",
        SERBIA: "SRB",
        SEYCHELLES: "SYC",
        "SIERRA LEONE": "SLE",
        SINGAPORE: "SGP",
        SLOVAKIA: "SVK",
        SLOVENIA: "SVN",
        "SOLOMON ISLANDS": "SLB",
        SOMALIA: "SOM",
        "SOUTH AFRICA": "ZAF",
        "SOUTH SUDAN": "SSD",
        SPAIN: "ESP",
        "SRI LANKA": "LKA",
        SUDAN: "SDN",
        SURINAME: "SUR",
        SWEDEN: "SWE",
        SWITZERLAND: "CHE",
        SYRIA: "SYR",
        TAJIKISTAN: "TJK",
        TANZANIA: "TZA",
        THAILAND: "THA",
        "TIMOR LESTE": "TLS",
        TOGO: "TGO",
        TONGA: "TON",
        "TRINIDAD AND TOBAGO": "TTO",
        TUNISIA: "TUN",
        TURKEY: "TUR",
        TURKMENISTAN: "TKM",
        TUVALU: "TUV",
        UGANDA: "UGA",
        UKRAINE: "UKR",
        "UNITED ARAB EMIRATES": "ARE",
        "UNITED KINGDOM": "GBR",
        "UNITED STATES": "USA",
        URUGUAY: "URY",
        UZBEKISTAN: "UZB",
        VANUATU: "VUT",
        VENEZUELA: "VEN",
        VIETNAM: "VNM",
        YEMEN: "YEM",
        ZAMBIA: "ZMB",
        ZIMBABWE: "ZWE",
        "BOLIVIA PLURINATIONAL STATE OF": "BOL",
        "BRUNEI DARUSSALAM": "BRN",
        CHINA: "CHN",
        "CHINA MACAO SAR": "MAC",
        "CHINA TAIWAN PROVINCE OF": "TWN",
        "CÔTE D'IVOIRE": "CIV",
        "DEMOCRATIC REPUBLIC": "COD",
        "IRAN ISLAMIC REPUBLIC OF": "IRN",
        "MICRONESIA FEDERATED STATES OF": "FSM",
        "REPUBLIC OF MOLDOVA": "MDA",
        REPUBLIC: "KOR",
        "MOLDOVA REPUBLIC OF": "MDA",
        "NETHERLANDS KINGDOM OF THE": "NLD",
        "NETHERLANDS KINGDOM": "NLD",
        "DEMOCRATIC PEOPLE'S REPUBLIC OF KOREA": "PRK",
        "DEMOCRATIC PEOPLE'S REPUBLIC": "PRK",
        "KOREA DEMOCRATIC PEOPLE'S REPUBLIC OF": "PRK",
        "REPUBLIC OF KOREA": "KOR",
        "KOREA REPUBLIC OF": "KOR",
        "RUSSIAN FEDERATION": "RUS",
        "SYRIAN ARAB REPUBLIC": "SYR",
        "UNITED REPUBLIC OF TANZANIA": "TZA",
        "UNITED REPUBLIC": "TZA",
        "TANZANIA UNITED REPUBLIC OF": "TZA",
        TÜRKIYE: "TUR",
        "UNITED KINGDOM OF GREAT BRITAIN AND NORTHERN IRELAND": "GBR",
        "UNITED STATES OF AMERICA": "USA",
        "VENEZUELA BOLIVARIAN REPUBLIC OF": "VEN",
        "VIET NAM": "VNM",
      };
      function updateYearDisplay() {
        const year = document.getElementById("yearSlider").value;
        const display = document.getElementById("yearDisplay");
        display.textContent = year;
      }

      function enableYearEdit() {
        const display = document.getElementById("yearDisplay");

        // ❗ Prevent re-trigger if already editing
        if (display.querySelector("input")) return;

        const currentYear = display.textContent;
        display.innerHTML = `<input id="yearInput" type="number"
                          class="slider-display-input"
                          value="${currentYear}" min="2025" max="2050"
                          onblur="applyYearEdit()"
                          onkeydown="if(event.key==='Enter') applyYearEdit()">`;

        setTimeout(() => document.getElementById("yearInput").focus(), 0);
      }

      function applyYearEdit() {
        const input = document.getElementById("yearInput");
        if (!input) return;

        let newYear = parseInt(input.value);

        // Ensure it's within slider bounds
        newYear = Math.max(2025, Math.min(2050, newYear));

        document.getElementById("yearSlider").value = newYear;
        document.getElementById("yearDisplay").textContent = newYear;

        updateMap(); // refresh plot
      }
      function updateAbatementDisplay() {
        const val = document.getElementById("abatementSlider").value;
        document.getElementById("abatementDisplay").textContent = val + " t";
      }

      function enableAbatementEdit() {
        const display = document.getElementById("abatementDisplay");

        if (display.querySelector("input")) return;

        const current = parseInt(display.textContent);

        display.innerHTML = `<input id="abatementInput" type="number"
                                            class="slider-display-input"
                                            value="${current}" min="0" max="1000000" step="100"
                                            onblur="applyAbatementEdit()"
                                            onkeydown="if(event.key==='Enter') applyAbatementEdit()">`;

        setTimeout(() => document.getElementById("abatementInput").focus(), 0);
      }

      function applyAbatementEdit() {
        const input = document.getElementById("abatementInput");
        if (!input) return;

        let newValue = parseInt(input.value);

        newValue = Math.max(0, Math.min(1000000, newValue)); // clamp range

        document.getElementById("abatementSlider").value = newValue;
        document.getElementById("abatementDisplay").textContent =
          newValue + " t";

        updateMap(); // refresh visualisation
      }
      function switchTab(tab) {
        document
          .querySelectorAll(".tab-button")
          .forEach((btn) => btn.classList.remove("active"));
        document
          .querySelectorAll(".tab-content")
          .forEach((content) => content.classList.remove("active"));
        event.target.classList.add("active");
        document.getElementById(`${tab}-tab`).classList.add("active");
      }

      function showStatus(message, type = "info") {
        const status = document.getElementById("status");
        status.textContent = message;
        status.className = "status " + type;
        status.style.display = "block";
        setTimeout(() => (status.style.display = "none"), 5000);
      }

      function normalizeCode(text) {
        return text
          .toUpperCase()
          .replace(/[^A-Z0-9]+/g, "_")
          .replace(/^_+|_+$/g, "");
      }

      function normalizeCountryName(name) {
        if (!name) return "";
        let normalized = name.toUpperCase();
        normalized = normalized.replace(/&/g, "AND").replace(/[''`]/g, "'");
        normalized = normalized.replace(/[_-]/g, " ");
        normalized = normalized.replace(/[^\w\s']/g, " ");
        return normalized.replace(/\s+/g, " ").trim();
      }

      function regionToISO3(regionName) {
        // Check if it's a numeric M49 code
        if (typeof regionName === "number") {
          // Check if it's a regional code
          if (M49_REGION_TO_ISO3[regionName]) {
            return M49_REGION_TO_ISO3[regionName]; // Return array of ISO3 codes
          }
          // Otherwise it's a country code
          return M49_TO_ISO3[regionName] || null;
        }

        // Check if it's a string that can be parsed as a number
        if (typeof regionName === "string") {
          const numericCode = parseInt(regionName);
          if (!isNaN(numericCode)) {
            // Check if it's a regional code
            if (M49_REGION_TO_ISO3[numericCode]) {
              return M49_REGION_TO_ISO3[numericCode]; // Return array of ISO3 codes
            }
            // Otherwise check if it's a country code
            if (M49_TO_ISO3[numericCode]) {
              return M49_TO_ISO3[numericCode];
            }
          }
        }

        // Otherwise, try string country name mapping
        const normalized = normalizeCountryName(regionName);
        return countryMapping[normalized] || null;
      }

      const dbDropZone = document.getElementById("dbDropZone");
      const dbFileInput = document.getElementById("dbFileInput");

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dbDropZone.addEventListener(eventName, (e) => {
          e.preventDefault();
          e.stopPropagation();
        });
      });

      ["dragenter", "dragover"].forEach((eventName) => {
        dbDropZone.addEventListener(eventName, () =>
          dbDropZone.classList.add("drag-over"),
        );
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dbDropZone.addEventListener(eventName, () =>
          dbDropZone.classList.remove("drag-over"),
        );
      });

      dbDropZone.addEventListener("drop", (e) => {
        const file = e.dataTransfer.files[0];
        if (file) loadSQLiteDB(file);
      });

      dbFileInput.addEventListener("change", (e) => {
        if (e.target.files[0]) loadSQLiteDB(e.target.files[0]);
      });

      async function loadSQLiteDB(file) {
        try {
          showStatus("Loading database...", "info");
          document.getElementById("dbDropZone").classList.add("hidden");

          if (!SQL) {
            showStatus("Initializing SQL.js library...", "info");
            await initializeSQLJS();
          }

          if (!SQL) {
            throw new Error(
              "Failed to initialize SQL.js library. Please refresh the page and try again.",
            );
          }

          showStatus("Reading database file...", "info");
          const arrayBuffer = await file.arrayBuffer();

          showStatus("Creating database connection...", "info");
          const db = new SQL.Database(new Uint8Array(arrayBuffer));

          try {
            const tableCheck = db.exec(
              "SELECT name FROM sqlite_master WHERE type='table' AND name='analysis_cases'",
            );
            if (tableCheck.length === 0) {
              throw new Error(
                "Database does not contain the expected 'analysis_cases' table",
              );
            }

            const columnCheck = db.exec("PRAGMA table_info(analysis_cases)");
            if (columnCheck.length === 0) {
              throw new Error("Unable to read table structure");
            }

            const columns = columnCheck[0].values.map((row) => row[1]); // column names are at index 1
            const requiredColumns = [
              "year",
              "fuel_route",
              "feedstock",
              "region",
              "abatement_potential",
              "saf_cost",
            ];
            const missingColumns = requiredColumns.filter(
              (col) => !columns.includes(col),
            );

            if (missingColumns.length > 0) {
              throw new Error(
                `Database missing required columns: ${missingColumns.join(
                  ", ",
                )}`,
              );
            }

            console.log("Database structure verified successfully");
          } catch (structureError) {
            db.close();
            throw new Error(
              `Invalid database structure: ${structureError.message}`,
            );
          }

          const years = [
            2025, 2026, 2027, 2028, 2029, 2030, 2031, 2032, 2033, 2034, 2035,
            2036, 2037, 2038, 2039, 2040, 2041, 2042, 2043, 2044, 2045, 2046,
            2047, 2048, 2049, 2050,
          ];
          const newData = {};

          showStatus("Processing data...", "info");

          for (let i = 0; i < years.length; i++) {
            const year = years[i];
            if (i % 5 === 0) {
              showStatus(
                `Processing year ${year}... (${i + 1}/${years.length})`,
                "info",
              );
            }
            newData[year] = { btl: [], atj: [], hefa: [], p2l: [] };

            const btlQuery = `
                                                SELECT year, fuel_route, feedstock, region, abatement_potential, saf_cost, hurdle_rate_assumption
                                                FROM analysis_cases
                                                WHERE year = ? AND fuel_route = 'BIOMASS_TO_LIQUID'
                                            `;
            const btlResult = db.exec(btlQuery, [year]);

            if (btlResult.length > 0) {
              btlResult[0].values.forEach((row) => {
                const feedstock = normalizeCode(row[2]);

                if (BIOMASS_TO_LIQUID_SINGULAR_FEEDSTOCKS.has(feedstock)) {
                  const isoResult = regionToISO3(row[3]);
                  // Check if it's a regional code (returns array) or country code (returns string)
                  if (Array.isArray(isoResult)) {
                    // Regional code - add entry for each country in region, marked as regional
                    isoResult.forEach((iso) => {
                      newData[year].btl.push({
                        iso_alpha: iso,
                        region: ISO3_TO_NAME[iso] || iso,
                        abatement_potential: row[4],
                        saf_cost: row[5],
                        is_regional: true,
                        feedstock: feedstock,
                        hurdle_rate_assumption: row[6],
                      });
                    });
                  } else if (isoResult) {
                    // Single country code - marked as specific
                    newData[year].btl.push({
                      iso_alpha: isoResult,
                      region: ISO3_TO_NAME[isoResult] || row[3],
                      abatement_potential: row[4],
                      saf_cost: row[5],
                      is_regional: false,
                      feedstock: feedstock,
                      hurdle_rate_assumption: row[6],
                    });
                  }
                }
              });
            }

            const atjQuery = `
                                                SELECT year, fuel_route, feedstock, region, abatement_potential, saf_cost, hurdle_rate_assumption
                                                FROM analysis_cases
                                                WHERE year = ? AND fuel_route = 'FERMENTATION_ALCOHOL_TO_JET'
                                            `;
            const atjResult = db.exec(atjQuery, [year]);

            if (atjResult.length > 0) {
              atjResult[0].values.forEach((row) => {
                const feedstock = normalizeCode(row[2]);
                if (SUGARY_RESIDUES.has(feedstock)) {
                  const isoResult = regionToISO3(row[3]);
                  if (Array.isArray(isoResult)) {
                    isoResult.forEach((iso) => {
                      newData[year].atj.push({
                        iso_alpha: iso,
                        region: ISO3_TO_NAME[iso] || iso,
                        abatement_potential: row[4],
                        saf_cost: row[5],
                        is_regional: true,
                        feedstock: feedstock,
                        hurdle_rate_assumption: row[6],
                      });
                    });
                  } else if (isoResult) {
                    newData[year].atj.push({
                      iso_alpha: isoResult,
                      region: ISO3_TO_NAME[isoResult] || row[3],
                      abatement_potential: row[4],
                      saf_cost: row[5],
                      is_regional: false,
                      feedstock: feedstock,
                      hurdle_rate_assumption: row[6],
                    });
                  }
                }
              });
            }

            const hefaQuery = `
                                                SELECT year, fuel_route, feedstock, region, abatement_potential, saf_cost, hurdle_rate_assumption
                                                FROM analysis_cases
                                                WHERE year = ? AND fuel_route = 'HEFA'
                                            `;
            const hefaResult = db.exec(hefaQuery, [year]);

            if (hefaResult.length > 0) {
              hefaResult[0].values.forEach((row) => {
                const feedstock = normalizeCode(row[2]);
                const isoResult = regionToISO3(row[3]);
                if (Array.isArray(isoResult)) {
                  isoResult.forEach((iso) => {
                    newData[year].hefa.push({
                      iso_alpha: iso,
                      region: ISO3_TO_NAME[iso] || iso,
                      abatement_potential: row[4],
                      saf_cost: row[5],
                      is_regional: true,
                      feedstock: feedstock,
                      hurdle_rate_assumption: row[6],
                    });
                  });
                } else if (isoResult) {
                  newData[year].hefa.push({
                    iso_alpha: isoResult,
                    region: ISO3_TO_NAME[isoResult] || row[3],
                    abatement_potential: row[4],
                    saf_cost: row[5],
                    is_regional: false,
                    feedstock: feedstock,
                    hurdle_rate_assumption: row[6],
                  });
                }
              });
            }

            const p2lQuery = `
                                                SELECT year, fuel_route, feedstock, region, abatement_potential, saf_cost, hurdle_rate_assumption
                                                FROM analysis_cases
                                                WHERE year = ? AND fuel_route = 'POWER_TO_LIQUID'
                                            `;
            const p2lResult = db.exec(p2lQuery, [year]);

            if (p2lResult.length > 0) {
              p2lResult[0].values.forEach((row) => {
                const feedstock = normalizeCode(row[2]);
                const isoResult = regionToISO3(row[3]);
                if (Array.isArray(isoResult)) {
                  isoResult.forEach((iso) => {
                    newData[year].p2l.push({
                      iso_alpha: iso,
                      region: ISO3_TO_NAME[iso] || iso,
                      abatement_potential: row[4],
                      saf_cost: row[5],
                      is_regional: true,
                      feedstock: feedstock,
                      hurdle_rate_assumption: row[6],
                    });
                  });
                } else if (isoResult) {
                  newData[year].p2l.push({
                    iso_alpha: isoResult,
                    region: ISO3_TO_NAME[isoResult] || row[3],
                    abatement_potential: row[4],
                    saf_cost: row[5],
                    is_regional: false,
                    feedstock: feedstock,
                    hurdle_rate_assumption: row[6],
                  });
                }
              });
            }
          }

          showStatus("Finalizing data processing...", "info");
          db.close();
          currentData = newData;
          currentDataSource = "db";
          showStatus(`✓ Successfully loaded database: ${file.name}`, "success");
          updateMap();
        } catch (error) {
          showStatus(`✗ Error loading database: ${error.message}`, "error");
          console.error("Database loading error:", error);
          // Show the drop zone again if there was an error
          document.getElementById("dbDropZone").classList.remove("hidden");
        }
      }

      const csvDropZone = document.getElementById("csvDropZone");
      const csvFileInput = document.getElementById("csvFileInput");

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        csvDropZone.addEventListener(eventName, (e) => {
          e.preventDefault();
          e.stopPropagation();
        });
      });

      ["dragenter", "dragover"].forEach((eventName) => {
        csvDropZone.addEventListener(eventName, () =>
          csvDropZone.classList.add("drag-over"),
        );
      });

      ["dragleave", "drop"].forEach((eventName) => {
        csvDropZone.addEventListener(eventName, () =>
          csvDropZone.classList.remove("drag-over"),
        );
      });

      csvDropZone.addEventListener("drop", (e) => {
        const file = e.dataTransfer.files[0];
        if (file) loadCSV(file);
      });

      csvFileInput.addEventListener("change", (e) => {
        if (e.target.files[0]) loadCSV(e.target.files[0]);
      });

      function loadCSV(file) {
        try {
          showStatus("Loading CSV file...", "info");
          document.getElementById("csvDropZone").classList.add("hidden");

          Papa.parse(file, {
            header: true,
            dynamicTyping: false, // Keep as strings for better control
            skipEmptyLines: true,
            complete: (results) => {
              try {
                console.log(
                  "CSV parsing completed. Rows found:",
                  results.data.length,
                );

                // Validate CSV structure
                if (!results.data || results.data.length === 0) {
                  throw new Error(
                    "CSV file is empty or contains no valid data",
                  );
                }

                // Check for required columns
                const firstRow = results.data[0];
                const requiredColumns = [
                  "year",
                  "fuel_route",
                  "feedstock",
                  "region",
                  "abatement_potential",
                  "saf_cost",
                  "hurdle_rate_assumption",
                ];
                const missingColumns = requiredColumns.filter(
                  (col) => !(col in firstRow),
                );

                if (missingColumns.length > 0) {
                  throw new Error(
                    `CSV missing required columns: ${missingColumns.join(", ")}`,
                  );
                }

                console.log("CSV structure validated successfully");

                // Debug: Log expected feedstock sets
                console.log("Expected feedstock sets:", {
                  BIOMASS_TO_LIQUID_SINGULAR_FEEDSTOCKS: Array.from(
                    BIOMASS_TO_LIQUID_SINGULAR_FEEDSTOCKS,
                  ),
                  SUGARY_RESIDUES: Array.from(SUGARY_RESIDUES),
                  POWER_TO_LIQUID: Array.from(POWER_TO_LIQUID),
                });

                showStatus("Processing CSV data...", "info");

                const newData = {};
                let processedRows = 0;
                let skippedRows = 0;

                results.data.forEach((row, index) => {
                  try {
                    // Debug: Log first few rows to understand data structure
                    if (index < 3) {
                      console.log(`Row ${index + 1}:`, row);
                    }

                    // Clean CSV-specific prefixes and validate data
                    const year = parseInt(row.year);

                    // Clean fuel route: remove "FuelRoute." prefix
                    let fuelRoute = row.fuel_route?.trim();
                    if (fuelRoute && fuelRoute.startsWith("FuelRoute.")) {
                      fuelRoute = fuelRoute.substring("FuelRoute.".length);
                    }

                    // Clean feedstock: remove known prefixes like "Feedstock." or "CarbonCaptureType."
                    let feedstockRaw = row.feedstock?.trim();
                    if (feedstockRaw) {
                      const prefixes = ["Feedstock.", "CarbonCaptureType."];
                      // remove any of the known prefixes repeatedly (handles nested/compound prefixes)
                      let prefixStripped = true;
                      while (prefixStripped) {
                        prefixStripped = false;
                        for (const p of prefixes) {
                          if (feedstockRaw.startsWith(p)) {
                            feedstockRaw = feedstockRaw.substring(p.length);
                            prefixStripped = true;
                          }
                        }
                      }
                    }
                    const feedstock = normalizeCode(feedstockRaw);

                    // Clean region: remove "M49Country : " prefix
                    let regionRaw = row.region?.trim();
                    if (regionRaw && regionRaw.startsWith("M49Country : ")) {
                      regionRaw = regionRaw.substring("M49Country : ".length);
                    } else if (
                      regionRaw &&
                      regionRaw.startsWith("M49Region : ")
                    ) {
                      regionRaw = regionRaw.substring("M49Region : ".length);
                    }

                    const hurdleRate = row.hurdle_rate_assumption?.trim();
                    const abatementPotential = parseFloat(
                      row.abatement_potential,
                    );
                    const safCost = parseFloat(row.saf_cost);

                    // Debug: Log validation results for first few rows
                    if (index < 3) {
                      console.log(`Row ${index + 1} validation:`, {
                        year: year,
                        yearValid: !isNaN(year),
                        fuelRoute: fuelRoute,
                        fuelRouteValid: !!fuelRoute,
                        feedstock: feedstock,
                        feedstockValid: !!feedstock,
                        region: regionRaw,
                        regionValid: !!regionRaw,
                        abatementPotential: abatementPotential,
                        abatementValid: !isNaN(abatementPotential),
                        safCost: safCost,
                        safCostValid: !isNaN(safCost),
                      });
                    }

                    // Skip rows with invalid data
                    if (
                      isNaN(year) ||
                      !fuelRoute ||
                      !feedstock ||
                      !regionRaw ||
                      isNaN(abatementPotential) ||
                      isNaN(safCost)
                    ) {
                      console.warn(
                        `Skipping row ${index + 1} due to invalid data:`,
                        row,
                      );
                      skippedRows++;
                      return;
                    }

                    if (!newData[year]) {
                      newData[year] = {
                        btl: [],
                        atj: [],
                        hefa: [],
                        p2l: [],
                      };
                    }

                    const isoResult = regionToISO3(regionRaw);

                    // Handle both regional codes (array) and country codes (string)
                    const isoList = Array.isArray(isoResult)
                      ? isoResult
                      : isoResult
                        ? [isoResult]
                        : [];
                    const isRegional = Array.isArray(isoResult);

                    if (isoList.length === 0) {
                      console.warn(
                        `Skipping row ${
                          index + 1
                        } - could not map region: ${regionRaw}`,
                      );
                      skippedRows++;
                      return;
                    }

                    isoList.forEach((iso) => {
                      const dataPoint = {
                        iso_alpha: iso,
                        region: ISO3_TO_NAME[iso] || regionRaw,
                        abatement_potential: abatementPotential,
                        saf_cost: safCost,
                        is_regional: isRegional,
                        feedstock: feedstock,
                        hurdle_rate_assumption: hurdleRate,
                      };

                      // Debug: Log route/feedstock matching for first few rows
                      if (index < 3) {
                        console.log(`Row ${index + 1} route/feedstock check:`, {
                          fuelRoute: fuelRoute,
                          feedstock: feedstock,
                          btlMatch:
                            fuelRoute === "BIOMASS_TO_LIQUID" &&
                            BIOMASS_TO_LIQUID_SINGULAR_FEEDSTOCKS.has(
                              feedstock,
                            ),
                          atjMatch:
                            fuelRoute === "FERMENTATION_ALCOHOL_TO_JET" &&
                            SUGARY_RESIDUES.has(feedstock),
                          hefaMatch: fuelRoute === "HEFA",
                          p2lMatch:
                            fuelRoute === "POWER_TO_LIQUID" &&
                            POWER_TO_LIQUID.has(feedstock),
                        });
                      }

                      if (
                        fuelRoute === "BIOMASS_TO_LIQUID" &&
                        BIOMASS_TO_LIQUID_SINGULAR_FEEDSTOCKS.has(feedstock)
                      ) {
                        newData[year].btl.push(dataPoint);
                      } else if (
                        fuelRoute === "FERMENTATION_ALCOHOL_TO_JET" &&
                        SUGARY_RESIDUES.has(feedstock)
                      ) {
                        newData[year].atj.push(dataPoint);
                      } else if (fuelRoute === "HEFA") {
                        newData[year].hefa.push(dataPoint);
                      } else if (
                        fuelRoute === "POWER_TO_LIQUID" &&
                        POWER_TO_LIQUID.has(feedstock)
                      ) {
                        newData[year].p2l.push(dataPoint);
                      } else {
                        // Debug: Log unmatched rows
                        if (index < 10) {
                          console.warn(
                            `Row ${
                              index + 1
                            } didn't match any route/feedstock combination:`,
                            {
                              fuelRoute: fuelRoute,
                              feedstock: feedstock,
                            },
                          );
                        }
                      }
                    });

                    processedRows++;
                  } catch (rowError) {
                    console.error(
                      `Error processing row ${index + 1}:`,
                      rowError,
                      row,
                    );
                    skippedRows++;
                  }
                });

                console.log(
                  `CSV processing complete. Processed: ${processedRows}, Skipped: ${skippedRows}`,
                );

                if (processedRows === 0) {
                  throw new Error("No valid data rows found in CSV file");
                }

                currentData = newData;
                currentDataSource = "csv";
                showStatus(
                  `✓ Successfully loaded CSV: ${file.name} (${processedRows} rows processed, ${skippedRows} skipped)`,
                  "success",
                );
                console.log("CSV data loaded:", currentData);
                updateMap();
              } catch (processingError) {
                showStatus(
                  `✗ Error processing CSV: ${processingError.message}`,
                  "error",
                );
                console.error("CSV processing error:", processingError);
                // Show the drop zone again if there was an error
                document
                  .getElementById("csvDropZone")
                  .classList.remove("hidden");
              }
            },
            error: (parseError) => {
              showStatus(`✗ Error parsing CSV: ${parseError.message}`, "error");
              console.error("CSV parsing error:", parseError);
              // Show the drop zone again if there was an error
              document.getElementById("csvDropZone").classList.remove("hidden");
            },
          });
        } catch (error) {
          showStatus(`✗ Error loading CSV: ${error.message}`, "error");
          console.error("CSV loading error:", error);
          // Show the drop zone again if there was an error
          document.getElementById("csvDropZone").classList.remove("hidden");
        }
      }
      function updateFeedstockOptions() {
        const selectedRoutes = getSelectedFuelRoutes();
        const feedstockGroupContainer =
          document.getElementById("feedstockGroup");
        const feedstockContainer = document.getElementById("feedstock");
        const groupSummaryElement = document.getElementById(
          "feedstockGroup-summary",
        );
        const feedstockSummaryElement =
          document.getElementById("feedstock-summary");

        // Clear existing options but keep summary elements
        Array.from(feedstockGroupContainer.children).forEach((child) => {
          if (!child.classList.contains("multi-select-summary")) {
            child.remove();
          }
        });
        Array.from(feedstockContainer.children).forEach((child) => {
          if (!child.classList.contains("multi-select-summary")) {
            child.remove();
          }
        });

        let allGroups = new Set();
        let allIndividualFeedstocks = new Set();

        // Gather groups and individual feedstocks for all selected routes
        selectedRoutes.forEach((route) => {
          if (route === "btl") {
            allGroups.add("FORESTRY_RESIDUES_ALL");
            allGroups.add("AGRICULTURAL_RESIDUES");
            allGroups.add("MUNICIPAL_SOLID_WASTE_ALL");
            FORESTRY_RESIDUES_ALL.forEach((f) =>
              allIndividualFeedstocks.add(f),
            );
            AGRICULTURAL_RESIDUES.forEach((f) =>
              allIndividualFeedstocks.add(f),
            );
            MUNICIPAL_SOLID_WASTE_ALL.forEach((f) =>
              allIndividualFeedstocks.add(f),
            );
          } else if (route === "atj") {
            allGroups.add("SUGARY_RESIDUES");
            SUGARY_RESIDUES.forEach((f) => allIndividualFeedstocks.add(f));
          } else if (route === "hefa") {
            allGroups.add("FATS_AND_OILS");
            allIndividualFeedstocks.add("TALL_OIL");
            allIndividualFeedstocks.add("USED_COOKING_OIL");
            allIndividualFeedstocks.add("TALLOW");
          } else if (route === "p2l") {
            allGroups.add("CARBON_DIOXIDE");
            CARBON_DIOXIDE.forEach((f) => allIndividualFeedstocks.add(f));
          }
        });

        // Create group checkboxes
        const groupArray = Array.from(allGroups);
        groupArray.forEach((group, index) => {
          const checkboxItem = document.createElement("div");
          checkboxItem.className = "checkbox-item";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = `group-${index}`;
          checkbox.value = group;
          checkbox.onchange = () => toggleFeedstockGroup(group);

          const label = document.createElement("label");
          label.htmlFor = `group-${index}`;

          // Set user-friendly text for groups
          if (group === "AGRICULTURAL_RESIDUES") {
            label.textContent = "Agricultural Residues (All)";
          } else if (group === "FORESTRY_RESIDUES_ALL") {
            label.textContent = "Forestry Residues (All)";
          } else if (group === "SUGARY_RESIDUES") {
            label.textContent = "Sugary Residues (All)";
          } else if (group === "CARBON_DIOXIDE") {
            label.textContent = "Carbon Dioxide (All)";
          } else if (group === "FATS_AND_OILS") {
            label.textContent = "Fats and Oils (All)";
          } else if (group === "MUNICIPAL_SOLID_WASTE_ALL") {
            label.textContent = "Municipal Solid Waste";
          }

          checkboxItem.appendChild(checkbox);
          checkboxItem.appendChild(label);

          // Insert before summary element
          feedstockGroupContainer.insertBefore(
            checkboxItem,
            groupSummaryElement,
          );
        });

        // Create individual feedstock checkboxes
        const feedstockArray = Array.from(allIndividualFeedstocks);
        feedstockArray.forEach((feedstock, index) => {
          const checkboxItem = document.createElement("div");
          checkboxItem.className = "checkbox-item";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = `feedstock-${index}`;
          checkbox.value = feedstock;
          checkbox.onchange = () => {
            updateFeedstockSummary();
            updateGroupStatus();
            updateMap();
          };

          // Default to first feedstock being checked if no selections yet
          if (index === 0 && getSelectedFeedstocks().length === 0) {
            checkbox.checked = true;
          }

          const label = document.createElement("label");
          label.htmlFor = `feedstock-${index}`;
          label.textContent = feedstock
            .replace(/_/g, " ")
            .toLowerCase()
            .replace(/\b\w/g, (char) => char.toUpperCase());

          checkboxItem.appendChild(checkbox);
          checkboxItem.appendChild(label);

          // Insert before summary element
          feedstockContainer.insertBefore(
            checkboxItem,
            feedstockSummaryElement,
          );
        });

        updateFeedstockGroupSummary();
        updateFeedstockSummary();
        updateFuelRouteSummary();
        updateMap();
      }

      // Helper function to get selected fuel routes
      function getSelectedFuelRoutes() {
        const checkboxes = document.querySelectorAll(
          '#fuelRoute input[type="checkbox"]:checked',
        );
        return Array.from(checkboxes).map((cb) => cb.value);
      }

      // Helper function to get selected feedstocks
      function getSelectedFeedstocks() {
        const checkboxes = document.querySelectorAll(
          '#feedstock input[type="checkbox"]:checked',
        );
        return Array.from(checkboxes).map((cb) => cb.value);
      }

      // Update fuel route summary
      function updateFuelRouteSummary() {
        const selectedRoutes = getSelectedFuelRoutes();
        const summaryElement = document.getElementById("fuelRoute-summary");
        if (summaryElement) {
          const count = selectedRoutes.length;
          if (count === 0) {
            summaryElement.textContent = "No routes selected";
            summaryElement.className = "multi-select-summary";
          } else if (count === 1) {
            summaryElement.textContent = "1 route selected";
            summaryElement.className = "multi-select-summary has-selections";
          } else {
            summaryElement.textContent = `${count} routes selected (weighted avg)`;
            summaryElement.className = "multi-select-summary has-selections";
          }
        }
      }

      // Update feedstock summary
      function updateFeedstockSummary() {
        const selectedFeedstocks = getSelectedFeedstocks();
        const summaryElement = document.getElementById("feedstock-summary");
        if (summaryElement) {
          const count = selectedFeedstocks.length;
          if (count === 0) {
            summaryElement.textContent = "No feedstocks selected";
            summaryElement.className = "multi-select-summary";
          } else if (count === 1) {
            summaryElement.textContent = "1 feedstock selected";
            summaryElement.className = "multi-select-summary has-selections";
          } else {
            summaryElement.textContent = `${count} feedstocks selected (weighted avg)`;
            summaryElement.className = "multi-select-summary has-selections";
          }
        }
      }

      // Helper function to get selected feedstock groups
      function getSelectedFeedstockGroups() {
        const checkboxes = document.querySelectorAll(
          '#feedstockGroup input[type="checkbox"]:checked',
        );
        return Array.from(checkboxes).map((cb) => cb.value);
      }

      // Update feedstock group summary
      function updateFeedstockGroupSummary() {
        const selectedGroups = getSelectedFeedstockGroups();
        const summaryElement = document.getElementById(
          "feedstockGroup-summary",
        );
        if (summaryElement) {
          const count = selectedGroups.length;
          if (count === 0) {
            summaryElement.textContent = "No groups selected";
            summaryElement.className = "multi-select-summary";
          } else if (count === 1) {
            summaryElement.textContent = "1 group selected";
            summaryElement.className = "multi-select-summary has-selections";
          } else {
            summaryElement.textContent = `${count} groups selected`;
            summaryElement.className = "multi-select-summary has-selections";
          }
        }
      }

      // Toggle all feedstocks in a group
      function toggleFeedstockGroup(groupName) {
        const groupCheckbox = document.querySelector(
          `#feedstockGroup input[value="${groupName}"]`,
        );
        const isChecked = groupCheckbox.checked;

        let feedstocksInGroup = [];
        if (groupName === "AGRICULTURAL_RESIDUES") {
          feedstocksInGroup = Array.from(AGRICULTURAL_RESIDUES);
        } else if (groupName === "FORESTRY_RESIDUES_ALL") {
          feedstocksInGroup = Array.from(FORESTRY_RESIDUES_ALL);
        } else if (groupName === "SUGARY_RESIDUES") {
          feedstocksInGroup = Array.from(SUGARY_RESIDUES);
        } else if (groupName === "CARBON_DIOXIDE") {
          feedstocksInGroup = Array.from(CARBON_DIOXIDE);
        } else if (groupName === "FATS_AND_OILS") {
          feedstocksInGroup = ["TALL_OIL", "USED_COOKING_OIL", "TALLOW"];
        } else if (groupName === "MUNICIPAL_SOLID_WASTE_ALL") {
          feedstocksInGroup = Array.from(MUNICIPAL_SOLID_WASTE_ALL);
        }

        // Toggle all feedstocks in this group
        feedstocksInGroup.forEach((feedstock) => {
          const feedstockCheckbox = document.querySelector(
            `#feedstock input[value="${feedstock}"]`,
          );
          if (feedstockCheckbox) {
            feedstockCheckbox.checked = isChecked;
          }
        });

        updateFeedstockGroupSummary();
        updateFeedstockSummary();
        updateMap();
      }

      // Update group status based on individual feedstock selections
      function updateGroupStatus() {
        const allGroups = [
          "AGRICULTURAL_RESIDUES",
          "FORESTRY_RESIDUES_ALL",
          "SUGARY_RESIDUES",
          "FATS_AND_OILS",
          "MUNICIPAL_SOLID_WASTE_ALL",
        ];

        allGroups.forEach((groupName) => {
          const groupCheckbox = document.querySelector(
            `#feedstockGroup input[value="${groupName}"]`,
          );
          if (!groupCheckbox) return;

          let feedstocksInGroup = [];
          if (groupName === "AGRICULTURAL_RESIDUES") {
            feedstocksInGroup = Array.from(AGRICULTURAL_RESIDUES);
          } else if (groupName === "FORESTRY_RESIDUES_ALL") {
            feedstocksInGroup = Array.from(FORESTRY_RESIDUES_ALL);
          } else if (groupName === "SUGARY_RESIDUES") {
            feedstocksInGroup = Array.from(SUGARY_RESIDUES);
          } else if (groupName === "CARBON_DIOXIDE") {
            feedstocksInGroup = Array.from(CARBON_DIOXIDE);
          } else if (groupName === "FATS_AND_OILS") {
            feedstocksInGroup = ["TALL_OIL", "USED_COOKING_OIL", "TALLOW"];
          } else if (groupName === "MUNICIPAL_SOLID_WASTE_ALL") {
            feedstocksInGroup = Array.from(MUNICIPAL_SOLID_WASTE_ALL);
          }

          // Check if all feedstocks in group are selected
          const allSelected = feedstocksInGroup.every((feedstock) => {
            const feedstockCheckbox = document.querySelector(
              `#feedstock input[value="${feedstock}"]`,
            );
            return feedstockCheckbox && feedstockCheckbox.checked;
          });

          // Check if some feedstocks in group are selected
          const someSelected = feedstocksInGroup.some((feedstock) => {
            const feedstockCheckbox = document.querySelector(
              `#feedstock input[value="${feedstock}"]`,
            );
            return feedstockCheckbox && feedstockCheckbox.checked;
          });

          if (allSelected) {
            groupCheckbox.checked = true;
            groupCheckbox.indeterminate = false;
          } else if (someSelected) {
            groupCheckbox.checked = false;
            groupCheckbox.indeterminate = true;
          } else {
            groupCheckbox.checked = false;
            groupCheckbox.indeterminate = false;
          }
        });

        updateFeedstockGroupSummary();
      }

      // Call this on page load to populate feedstock options
      window.addEventListener("DOMContentLoaded", () => {
        updateFeedstockOptions();
        // Initialize stat cards with empty state
        updateStatCards([]);
      });

      function processData(
        rawRegionData,
        minAbatement,
        aggregateByContinent = false,
      ) {
        if (aggregateByContinent) {
          return processContinentData(rawRegionData, minAbatement);
        }

        // When showing individual countries, ONLY use specific data
        // Regional estimates should not be displayed for individual countries
        const specificData = rawRegionData.filter((item) => !item.is_regional);

        const regionMap = new Map();

        specificData.forEach((item) => {
          const region = item.region;
          if (!regionMap.has(region)) {
            regionMap.set(region, {
              iso_alpha: item.iso_alpha,
              region: region,
              total_abatement: 0,
              weighted_sum: 0,
            });
          }

          const regionData = regionMap.get(region);
          regionData.total_abatement += item.abatement_potential;
          regionData.weighted_sum += item.saf_cost * item.abatement_potential;
        });

        const processedData = [];
        regionMap.forEach((regionData) => {
          if (regionData.total_abatement >= minAbatement) {
            const weighted_saf_cost =
              regionData.total_abatement > 0
                ? regionData.weighted_sum / regionData.total_abatement
                : null;

            if (weighted_saf_cost !== null) {
              processedData.push({
                iso_alpha: regionData.iso_alpha,
                region: regionData.region,
                weighted_saf_cost: weighted_saf_cost,
                total_abatement: regionData.total_abatement,
              });
            }
          }
        });
        return processedData;
      }

      function processContinentData(rawRegionData, minAbatement) {
        const qualifyingCountries = rawRegionData.filter((item) => {
          return item.abatement_potential >= minAbatement;
        });

        const continentMap = new Map();

        qualifyingCountries.forEach((item) => {
          const continent = ISO3_TO_CONTINENT[item.iso_alpha];
          if (!continent) return;

          if (!continentMap.has(continent)) {
            continentMap.set(continent, {
              continent: continent,
              total_abatement: 0,
              weighted_sum: 0,
              countries: new Map(),
            });
          }

          const continentData = continentMap.get(continent);
          continentData.total_abatement += item.abatement_potential;
          continentData.weighted_sum +=
            item.saf_cost * item.abatement_potential;

          if (!continentData.countries.has(item.iso_alpha)) {
            continentData.countries.set(item.iso_alpha, {
              iso_alpha: item.iso_alpha,
              region: item.region,
            });
          }
        });

        const processedData = [];

        // For each continent with qualifying countries, show ALL countries in that continent
        continentMap.forEach((continentData, continent) => {
          const weighted_saf_cost =
            continentData.total_abatement > 0
              ? continentData.weighted_sum / continentData.total_abatement
              : null;

          if (weighted_saf_cost === null) return;

          // Get all countries in this continent from the ISO3_TO_CONTINENT mapping
          Object.entries(ISO3_TO_CONTINENT).forEach(([iso3, cont]) => {
            if (cont === continent) {
              const countryName = ISO3_TO_NAME[iso3] || iso3;
              processedData.push({
                iso_alpha: iso3,
                region: countryName,
                continent: continent,
                weighted_saf_cost: weighted_saf_cost,
                total_abatement: continentData.total_abatement,
                country_count: continentData.countries.size,
              });
            }
          });
        });

        return processedData;
      }

      function createChoroplethTrace(
        selectedData,
        fuelRoute,
        year,
        constantScale,
        isContinent = false,
      ) {
        const locations = selectedData.map((d) => d.iso_alpha);
        const z = selectedData.map((d) => d.weighted_saf_cost);

        let hovertext, customdata, hovertemplate;

        if (isContinent) {
          hovertext = selectedData.map((d) => `${d.region} (${d.continent})`);
          customdata = selectedData.map((d) => [
            d.total_abatement,
            d.weighted_saf_cost,
            d.country_count,
            d.continent,
          ]);
          hovertemplate =
            "<b>%{text}</b><br>" +
            "Continent: %{customdata[3]}<br>" +
            "Countries in continent: %{customdata[2]}<br>" +
            "Total Abatement: %{customdata[0]:.1f} t<br>" +
            "Weighted SAF Cost: %{customdata[1]:.2f} " +
            COLORBAR_LABEL +
            "<br>" +
            "<extra></extra>";
        } else {
          hovertext = selectedData.map((d) => d.region);
          customdata = selectedData.map((d) => [
            d.total_abatement,
            d.weighted_saf_cost,
          ]);
          hovertemplate =
            "<b>%{text}</b><br>" +
            "Total Abatement: %{customdata[0]:.1f} t<br>" +
            "Weighted SAF Cost: %{customdata[1]:.2f} " +
            COLORBAR_LABEL +
            "<br>" +
            "<extra></extra>";
        }

        let zmin, zmax, tickvals;

        if (constantScale) {
          zmin = 500;
          zmax = 9000;
          tickvals = [
            500, 1500, 2500, 3500, 4500, 5500, 6500, 7500, 8500, 9000,
          ];
        } else {
          const yearNum = parseInt(year);

          if (fuelRoute === "btl") {
            if (yearNum < 2030) {
              zmin = 4000;
              zmax = 6000;
              tickvals = [4000, 4400, 4800, 5200, 5600, 6000];
            } else {
              zmin = 2000;
              zmax = 4000;
              tickvals = [2000, 2400, 2800, 3200, 3600, 4000];
            }
          } else if (fuelRoute === "atj") {
            if (yearNum < 2030) {
              zmin = 8000;
              zmax = 9000;
              tickvals = [8000, 8200, 8400, 8600, 8800, 9000];
            } else {
              zmin = 3000;
              zmax = 5000;
              tickvals = [3000, 3400, 3800, 4200, 4600, 5000];
            }
          } else if (fuelRoute === "hefa") {
            if (yearNum < 2030) {
              zmin = 500;
              zmax = 2000;
              tickvals = [500, 800, 1100, 1400, 1700, 2000];
            } else {
              zmin = 500;
              zmax = 2000;
              tickvals = [500, 800, 1100, 1400, 1700, 2000];
            }
          } else if (fuelRoute === "p2l") {
            if (yearNum < 2030) {
              zmin = 6000;
              zmax = 13000;
              tickvals = [6000, 7000, 8000, 9000, 10000, 11000, 12000, 13000];
            } else {
              zmin = 5000;
              zmax = 9000;
              tickvals = [5000, 6000, 7000, 8000, 9000];
            }
          }
        }

        return {
          type: "choropleth",
          locations: locations,
          z: z,
          zmin: zmin,
          zmax: zmax,
          text: hovertext,
          customdata: customdata,
          hovertemplate: hovertemplate,
          colorscale: [
            [0, "#2c3832"], // low values dark green fill
            [0.33, "#85b09a"], // low-mid values teal fill
            [0.66, "#ffa9a0"], // high values cherry fill
            [1, "#ff7668"], // high values dark cherry fill
          ],
          colorbar: {
            title: COLORBAR_LABEL,
            tickvals: tickvals,
          },
        };
      }

      function updateYearDisplay() {
        document.getElementById("yearDisplay").textContent =
          document.getElementById("yearSlider").value;
      }

      function updateAbatementDisplay() {
        const value = document.getElementById("abatementSlider").value;
        document.getElementById("abatementDisplay").textContent = value + " t";
      }

      function updateMap() {
        if (currentDataSource === "none") {
          // show no data loaded message
          document.getElementById("plotDiv").innerHTML = `
                                      <div class="no-data-message">
                                          <p><strong>No data loaded</strong></p>
                                          <p>Please load a SQLite database or CSV file to view the choropleth map.</p>
                                      </div>
                                  `;
          return;
        } else {
          // clear any previous no data message
          document.getElementById("plotDiv").innerHTML = "";
        }

        const selectedRoutes = getSelectedFuelRoutes();
        const selectedFeedstocks = getSelectedFeedstocks();
        const selectedYear = document.getElementById("yearSlider").value;
        const minAbatement = parseFloat(
          document.getElementById("abatementSlider").value,
        );
        const constantScale = document.getElementById("constantScale").checked;
        const aggregateByContinent =
          document.getElementById("aggregateRegion").checked;
        const selectedHurdleRate =
          document.getElementById("hurdleSlider").value;

        if (selectedRoutes.length === 0 || selectedFeedstocks.length === 0) {
          console.warn("No routes or feedstocks selected");
          return;
        }

        const yearData = currentData[selectedYear];
        if (!yearData) {
          console.error("No data for year:", selectedYear);
          return;
        }

        // Collect all data for selected routes and feedstocks
        let allFilteredData = [];

        selectedRoutes.forEach((route) => {
          const routeRawData = yearData[route];
          if (!routeRawData) {
            console.warn("No data for route:", route);
            return;
          }

          selectedFeedstocks.forEach((feedstock) => {
            let feedstockData;

            if (GROUP_FEEDSTOCKS.has(feedstock)) {
              // Grouped feedstocks
              if (feedstock === "FORESTRY_RESIDUES_ALL") {
                feedstockData = routeRawData.filter((item) =>
                  FORESTRY_RESIDUES_ALL.has(item.feedstock),
                );
              } else if (feedstock === "AGRICULTURAL_RESIDUES") {
                feedstockData = routeRawData.filter((item) =>
                  AGRICULTURAL_RESIDUES.has(item.feedstock),
                );
              } else if (feedstock === "SUGARY_RESIDUES") {
                feedstockData = routeRawData.filter((item) =>
                  SUGARY_RESIDUES.has(item.feedstock),
                );
              } else if (feedstock === "CARBON_DIOXIDE") {
                feedstockData = routeRawData.filter((item) =>
                  CARBON_DIOXIDE.has(item.feedstock),
                );
              } else if (feedstock === "FATS_AND_OILS") {
                feedstockData = routeRawData.filter(
                  (item) =>
                    item.feedstock === "TALL_OIL" ||
                    item.feedstock === "USED_COOKING_OIL" ||
                    item.feedstock === "TALLOW",
                );
              } else if (feedstock === "MUNICIPAL_SOLID_WASTE_ALL") {
                feedstockData = routeRawData.filter((item) =>
                  MUNICIPAL_SOLID_WASTE_ALL.has(item.feedstock),
                );
              } else {
                feedstockData = [...routeRawData];
              }
            } else {
              // specific feedstock selected
              feedstockData = routeRawData.filter(
                (item) => item.feedstock === feedstock,
              );
            }

            // Filter by hurdle rate
            feedstockData = feedstockData.filter(
              (item) => item.hurdle_rate_assumption === selectedHurdleRate,
            );

            allFilteredData.push(...feedstockData);
          });
        });

        // Apply weighted averaging by region/country
        const weightedData = calculateWeightedAverages(allFilteredData);

        const processedData = processData(
          weightedData,
          minAbatement,
          aggregateByContinent,
        );

        const trace = createChoroplethTrace(
          processedData,
          selectedRoutes.length === 1 ? selectedRoutes[0] : "multi",
          selectedYear,
          constantScale,
          aggregateByContinent,
        );

        const layout = {
          geo: {
            fitbounds: "locations",
            bgcolor: "rgba(0,0,0,0)",
          },
          margin: { l: 20, r: 20, t: 20, b: 20 },
          paper_bgcolor: "rgba(0,0,0,0)",
          plot_bgcolor: "rgba(0,0,0,0)",
          hoverlabel: {
            bgcolor: "rgba(255, 255, 255, 0.95)",
            bordercolor: "rgba(255, 255, 255, 0.3)",
            font: {
              family: "DM Sans, Arial, sans-serif",
              size: 14,
              color: "#333",
            },
            align: "left",
          },
        };

        Plotly.newPlot("plotDiv", [trace], layout, {
          responsive: true,
        });

        if (Object.keys(savedView).length > 0) {
          Plotly.relayout("plotDiv", savedView);
        }
        // Track user zoom events
        document.getElementById("plotDiv").on("plotly_relayout", function (ev) {
          savedView = { ...savedView, ...ev }; // store changes like zoom, centre, lat/lon bounds
        });

        // sync route plot
        updateRoutePlot();

        // update stat cards with ONLY SPECIFIC data (not regional estimates)
        // Filter weightedData to only include entries with actual specific data
        const specificOnlyData = weightedData.filter(
          (item) => !item.is_regional,
        );
        updateStatCards(specificOnlyData);
      }

      // Calculate weighted averages by abatement potential for multiple selections
      function calculateWeightedAverages(dataArray) {
        // CRITICAL FIX: Filter out regional data for countries with specific data
        // This must happen BEFORE aggregation to prevent double-counting
        const specificEntries = dataArray.filter((item) => !item.is_regional);
        const regionalEntries = dataArray.filter((item) => item.is_regional);

        // Get set of countries that have specific data
        const countriesWithSpecificData = new Set(
          specificEntries.map((item) => item.iso_alpha),
        );

        // Filter regional entries to only include countries without specific data
        const filteredRegionalEntries = regionalEntries.filter(
          (item) => !countriesWithSpecificData.has(item.iso_alpha),
        );

        // Combine specific entries with filtered regional entries
        const combinedData = [...specificEntries, ...filteredRegionalEntries];

        const regionMap = new Map();

        combinedData.forEach((item) => {
          const regionKey = item.region || item.iso_alpha;

          if (!regionMap.has(regionKey)) {
            regionMap.set(regionKey, {
              region: item.region,
              iso_alpha: item.iso_alpha,
              totalAbatement: 0,
              weightedSafCost: 0,
              is_regional: item.is_regional,
              data_points: [],
            });
          }

          const regionData = regionMap.get(regionKey);
          regionData.totalAbatement += item.abatement_potential;
          regionData.weightedSafCost +=
            item.saf_cost * item.abatement_potential;
          regionData.data_points.push(item);
        });

        // Convert back to array with averaged values
        const result = [];
        regionMap.forEach((regionData, regionKey) => {
          if (regionData.totalAbatement > 0) {
            const averagedSafCost =
              regionData.weightedSafCost / regionData.totalAbatement;

            // Create a representative data point
            const representativePoint = regionData.data_points[0];
            result.push({
              ...representativePoint,
              saf_cost: averagedSafCost,
              abatement_potential: regionData.totalAbatement,
            });
          }
        });

        return result;
      }

      // Function to update all stat cards
      function updateStatCards(filteredData) {
        updateTopAbatementCard(filteredData);
        updateTopCostCard(filteredData);
        updateUKComparisonCard(filteredData);
      }

      // Function to update Top 5 Countries by Abatement card
      function updateTopAbatementCard(filteredData) {
        const container = document.getElementById("top-abatement-content");

        if (!filteredData || filteredData.length === 0) {
          container.innerHTML =
            '<div class="stat-item"><span class="stat-label">No data available</span></div>';
          return;
        }

        // Aggregate by country/region
        const countryData = {};
        filteredData.forEach((item) => {
          const country = getCountryName(item.region || item.iso_alpha);
          if (!countryData[country]) {
            countryData[country] = {
              totalAbatement: 0,
              items: [],
            };
          }
          countryData[country].totalAbatement += item.abatement_potential || 0;
          countryData[country].items.push(item);
        });

        // Sort and get top 5
        const sortedCountries = Object.entries(countryData)
          .sort((a, b) => b[1].totalAbatement - a[1].totalAbatement)
          .slice(0, 5);

        // Build HTML
        let html = "";
        sortedCountries.forEach(([country, data], index) => {
          const abatement = (data.totalAbatement / 1000000).toFixed(2); // Convert to millions

          html += `
              <div class="stat-item">
                <span class="stat-label">${index + 1}. ${country}</span>
                <span class="stat-value">${abatement}M t</span>
              </div>
            `;
        });

        container.innerHTML = html;
      }

      // Function to update Top 5 Countries by Cheapest Cost card
      function updateTopCostCard(filteredData) {
        const container = document.getElementById("top-cost-content");

        if (!filteredData || filteredData.length === 0) {
          container.innerHTML =
            '<div class="stat-item"><span class="stat-label">No data available</span></div>';
          return;
        }

        // Calculate weighted average cost per country/region
        const countryData = {};
        filteredData.forEach((item) => {
          const country = getCountryName(item.region || item.iso_alpha);
          const abatement = item.abatement_potential || 0;
          const cost = item.saf_cost || 0;

          if (!countryData[country]) {
            countryData[country] = {
              totalWeightedCost: 0,
              totalAbatement: 0,
            };
          }
          countryData[country].totalWeightedCost += cost * abatement;
          countryData[country].totalAbatement += abatement;
        });

        // Calculate averages and sort
        const sortedCountries = Object.entries(countryData)
          .map(([country, data]) => ({
            country,
            avgCost:
              data.totalAbatement > 0
                ? data.totalWeightedCost / data.totalAbatement
                : 0,
          }))
          .filter((item) => item.avgCost > 0)
          .sort((a, b) => a.avgCost - b.avgCost)
          .slice(0, 5);

        // Build HTML
        let html = "";
        sortedCountries.forEach(({ country, avgCost }, index) => {
          html += `
              <div class="stat-item">
                <span class="stat-label">${index + 1}. ${country}</span>
                <span class="stat-value">$${avgCost.toFixed(0)}/t</span>
              </div>
            `;
        });

        container.innerHTML = html;
      }

      // Function to update UK Comparison card
      function updateUKComparisonCard(filteredData) {
        const container = document.getElementById("uk-comparison-content");

        if (!filteredData || filteredData.length === 0) {
          container.innerHTML =
            '<div class="stat-item"><span class="stat-label">No data available</span></div>';
          return;
        }

        // Find UK data
        const ukData = filteredData.filter((item) => {
          const country = getCountryName(item.region || item.iso_alpha);
          return (
            country === "United Kingdom" ||
            country === "UK" ||
            (item.iso_alpha && item.iso_alpha.toLowerCase() === "gbr")
          );
        });

        if (ukData.length === 0) {
          container.innerHTML =
            '<div class="stat-item"><span class="stat-label">UK data not available</span></div>';
          return;
        }

        // Calculate UK metrics
        const ukTotalAbatement = ukData.reduce(
          (sum, item) => sum + (item.abatement_potential || 0),
          0,
        );
        const ukWeightedCost = ukData.reduce(
          (sum, item) =>
            sum + (item.saf_cost || 0) * (item.abatement_potential || 0),
          0,
        );
        const ukAvgCost =
          ukTotalAbatement > 0 ? ukWeightedCost / ukTotalAbatement : 0;

        // Calculate global metrics
        const allAbatements = filteredData
          .map((item) => item.abatement_potential || 0)
          .filter((x) => x > 0);
        const allCosts = filteredData
          .map((item) => item.saf_cost || 0)
          .filter((x) => x > 0);

        const globalTotalAbatement = filteredData.reduce(
          (sum, item) => sum + (item.abatement_potential || 0),
          0,
        );
        const globalWeightedCost = filteredData.reduce(
          (sum, item) =>
            sum + (item.saf_cost || 0) * (item.abatement_potential || 0),
          0,
        );
        const globalAvgCost =
          globalTotalAbatement > 0
            ? globalWeightedCost / globalTotalAbatement
            : 0;

        const minCost = Math.min(...allCosts);
        const maxCost = Math.max(...allCosts);

        // Build HTML
        const ukAbatementMT = (ukTotalAbatement / 1000000).toFixed(2);
        const globalAbatementMT = (globalTotalAbatement / 1000000).toFixed(2);

        // Calculate percentage comparisons
        const abatementPercentage =
          globalTotalAbatement > 0
            ? ((ukTotalAbatement / globalTotalAbatement) * 100).toFixed(1)
            : 0;

        // Calculate UK position vs global cost metrics
        const ukVsMin =
          minCost > 0
            ? (((ukAvgCost - minCost) / minCost) * 100).toFixed(0)
            : 0;
        const ukVsMax =
          maxCost > 0
            ? (((ukAvgCost - maxCost) / maxCost) * 100).toFixed(0)
            : 0;
        const ukVsAvg =
          globalAvgCost > 0
            ? (((ukAvgCost - globalAvgCost) / globalAvgCost) * 100).toFixed(0)
            : 0;

        // Determine trend indicators for cost comparisons only
        const minTrendClass = ukVsMin < 0 ? "trend-down" : "trend-up";
        const avgTrendClass = ukVsAvg < 0 ? "trend-down" : "trend-up";
        const maxTrendClass = ukVsMax < 0 ? "trend-down" : "trend-up";

        const minTrend = `<span class="trend-indicator ${minTrendClass}">${
          ukVsMin >= 0 ? "+" : ""
        }${ukVsMin}%</span>`;
        const avgTrend = `<span class="trend-indicator ${avgTrendClass}">${
          ukVsAvg >= 0 ? "+" : ""
        }${ukVsAvg}%</span>`;
        const maxTrend = `<span class="trend-indicator ${maxTrendClass}">${
          ukVsMax >= 0 ? "+" : ""
        }${ukVsMax}%</span>`;

        const html = `
            <div class="stat-item">
              <span class="stat-label">UK Abatement Potential</span>
              <span class="stat-value">
                <span class="uk-comparison-value">${ukAbatementMT}M t</span>
              </span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Global Abatement Potential</span>
              <span class="stat-value">
                <span class="global-comparison-value">${globalAbatementMT}M t</span>
              </span>
            </div>
            <div class="stat-item">
              <span class="stat-label">UK Share of Global</span>
              <span class="stat-value">
                <span class="comparison-percentage">${abatementPercentage}%</span>
              </span>
            </div>
            <div class="stat-item">
              <span class="stat-label">UK SAF Cost</span>
              <span class="stat-value">
                <span class="uk-comparison-value">$${ukAvgCost.toFixed(
                  0,
                )}/t</span>
              </span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Global Min Cost</span>
              <span class="stat-value">
                <span class="global-comparison-value">$${minCost.toFixed(
                  0,
                )}/t ${minTrend}</span>
              </span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Global Avg Cost</span>
              <span class="stat-value">
                <span class="global-comparison-value">$${globalAvgCost.toFixed(
                  0,
                )}/t ${avgTrend}</span>
              </span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Global Max Cost</span>
              <span class="stat-value">
                <span class="global-comparison-value">$${maxCost.toFixed(
                  0,
                )}/t ${maxTrend}</span>
              </span>
            </div>
          `;

        container.innerHTML = html;
      }

      // Helper function to get readable country name
      function getCountryName(regionCode) {
        if (!regionCode) return "Unknown";

        // If it's already a country name (not a code), return as is
        if (regionCode.length > 3) return regionCode;

        // Map common ISO codes to country names
        const countryNames = {
          USA: "United States",
          GBR: "United Kingdom",
          DEU: "Germany",
          FRA: "France",
          ITA: "Italy",
          ESP: "Spain",
          CHN: "China",
          IND: "India",
          BRA: "Brazil",
          CAN: "Canada",
          AUS: "Australia",
          JPN: "Japan",
          RUS: "Russia",
          MEX: "Mexico",
          ARG: "Argentina",
          ZAF: "South Africa",
          EGY: "Egypt",
          NGA: "Nigeria",
          KEN: "Kenya",
          ETH: "Ethiopia",
          TUR: "Turkey",
          SAU: "Saudi Arabia",
          IRN: "Iran",
          PAK: "Pakistan",
          BGD: "Bangladesh",
          VNM: "Vietnam",
          THA: "Thailand",
          MYS: "Malaysia",
          IDN: "Indonesia",
          PHL: "Philippines",
          KOR: "South Korea",
          TWN: "Taiwan",
        };

        return countryNames[regionCode.toUpperCase()] || regionCode;
      }

      // Helper to safely get property with multiple possible casings
      function getProp(obj, names) {
        for (const n of names) {
          if (obj && Object.prototype.hasOwnProperty.call(obj, n))
            return obj[n];
        }
        return undefined;
      }

      function parseYear(v) {
        const n = Number(v);
        return Number.isFinite(n) ? n : parseInt(v) || NaN;
      }

      function buildRowsFromCurrentData(
        currentData,
        route,
        feedstock,
        hurdleRate,
      ) {
        const rows = [];
        if (!currentData || typeof currentData !== "object") return rows;
        // currentData structure may be { year: { btl: [], atj: [], ... }, ... }
        Object.keys(currentData).forEach((y) => {
          const yearBlock = currentData[y];
          if (!yearBlock) return;
          const block =
            yearBlock[route] ||
            yearBlock[route.toLowerCase()] ||
            yearBlock[route.toUpperCase()];
          if (!Array.isArray(block)) return;
          //filter by hurdle rate if speficied
          let filteredByHurdle;
          if (hurdleRate) {
            filteredByHurdle = block.filter(
              (item) => item.hurdle_rate_assumption === hurdleRate,
            );
          } else {
            filteredByHurdle = block;
          }
          const selectedFeedstock = feedstock;
          // filter by feedstock if specified
          let filteredBlock;
          if (selectedFeedstock) {
            filteredBlock = filteredByHurdle.filter(
              (item) => item.feedstock === selectedFeedstock,
            );
          } else {
            filteredBlock = filteredByHurdle;
          }
          filteredBlock.forEach((item) => {
            const iso = getProp(item, ["iso_alpha", "iso", "ISO"]) || null;
            const continent =
              typeof ISO3_TO_CONTINENT !== "undefined" && iso
                ? ISO3_TO_CONTINENT[iso] || null
                : null;
            const country =
              getProp(item, ["region", "Country", "country"]) || null;
            const cost = getProp(item, ["saf_cost", "SAF_Cost", "safCost"]);
            const abatement = getProp(item, [
              "abatement_potential",
              "Abatement_Potential",
              "abatementPotential",
            ]);
            rows.push({
              Year: parseYear(y),
              Continent: continent || getProp(item, ["continent"]) || null,
              Country: country,
              SAF_Cost: Number(cost),
              Abatement_Potential: Number(abatement),
            });
          });
        });
        return rows;
      }

      function aggregateByContinentYear(rows) {
        // returns { continent: { year: {weightedSum, totalAbatement} } }
        const agg = {};
        rows.forEach((r) => {
          const cont = r.Continent || "Other";
          const year = parseYear(r.Year);
          const cost = Number(r.SAF_Cost);
          const abatement = Number(r.Abatement_Potential);
          if (
            !Number.isFinite(year) ||
            Number.isNaN(cost) ||
            Number.isNaN(abatement)
          )
            return;
          agg[cont] = agg[cont] || {};
          agg[cont][year] = agg[cont][year] || {
            weightedSum: 0,
            totalAbatement: 0,
          };
          agg[cont][year].weightedSum += cost * abatement;
          agg[cont][year].totalAbatement += abatement;
        });
        return agg;
      }

      function makeTracesFromAgg(agg, sortedYears, highlightUK) {
        // Assign a distinct colour to each continent (used by makeTracesFromAgg)
        const routeColors = {
          Africa: "#85b09a", // teal/green (matches primary color)
          Asia: "#ff7668", // warm cherry
          Europe: "#d16bd1", // light purple
          "North America": "#ffa9a0", // light coral
          "South America": "#d62728", // red
          Oceania: "#1f77b4", // blue
          Other: "#888888", // neutral grey for unknowns
          "United Kingdom": "#000000", // black (special highlighted trace)
        };
        const traces = [];
        Object.keys(agg).forEach((cont) => {
          const years = [];
          const vals = [];
          sortedYears.forEach((y) => {
            if (agg[cont][y] && agg[cont][y].totalAbatement > 0) {
              years.push(y);
              vals.push(agg[cont][y].weightedSum / agg[cont][y].totalAbatement);
            }
          });
          if (years.length) {
            traces.push({
              name: cont,
              x: years,
              y: vals,
              mode: "lines+markers",
              line: {
                width: 3,
                color: routeColors[cont],
                shape: "spline",
              },
              marker: {
                size: 6,
                color: routeColors[cont],
                line: {
                  color: "white",
                  width: 2,
                },
              },
              hovertemplate:
                "<b>%{fullData.name}</b><br>" +
                "Cost: $%{y:,.0f}/tonne<br>" +
                "<extra></extra>",
            });
          }
        });

        // Optionally move UK to its own trace handled outside (see below)
        return traces;
      }

      function updateRoutePlot() {
        try {
          const selectedRoutes = getSelectedFuelRoutes();
          const selectedFeedstocks = getSelectedFeedstocks();

          if (selectedRoutes.length === 0) {
            document.getElementById("routePlot").innerHTML =
              '<div class="no-data-message"><p>No fuel routes selected</p></div>';
            return;
          }

          const plotEl = document.getElementById("routePlot");
          if (!plotEl) return;

          const selectedHurdleRate =
            document.getElementById("hurdleSlider")?.value;

          if (typeof currentData === "undefined") {
            plotEl.innerHTML =
              '<div class="no-data-message"><p>No data available</p></div>';
            return;
          }

          // Organize data by year, then aggregate using calculateWeightedAverages for each year
          const dataByYear = {};

          Object.keys(currentData).forEach((year) => {
            const yearBlock = currentData[year];
            if (!yearBlock) return;

            let allYearData = [];

            selectedRoutes.forEach((route) => {
              const routeKey = route.toLowerCase();
              const routeData = yearBlock[routeKey];
              if (!Array.isArray(routeData)) return;

              let filteredData = routeData.filter(
                (item) => item.hurdle_rate_assumption === selectedHurdleRate,
              );

              if (selectedFeedstocks.length > 0) {
                filteredData = filteredData.filter((item) =>
                  selectedFeedstocks.includes(item.feedstock),
                );
              }

              allYearData.push(...filteredData);
            });

            if (allYearData.length > 0) {
              // Use calculateWeightedAverages to aggregate by region with weighted averaging
              const weightedData = calculateWeightedAverages(allYearData);
              dataByYear[year] = weightedData;
            }
          });

          if (Object.keys(dataByYear).length === 0) {
            plotEl.innerHTML =
              '<div class="no-data-message"><p>No data available for selected routes/feedstocks</p></div>';
            return;
          }

          // Organize weighted data by continent and year
          const continentYearData = {};
          const ukYearData = {};

          Object.keys(dataByYear).forEach((year) => {
            dataByYear[year].forEach((item) => {
              const iso = item.iso_alpha;
              const continent = iso && ISO3_TO_CONTINENT[iso];
              const isUK =
                iso === "GBR" ||
                (item.region || "").toLowerCase() === "united kingdom" ||
                (item.region || "").toLowerCase() === "uk";

              if (isUK) {
                // Track UK separately
                if (!ukYearData[year]) {
                  ukYearData[year] = { weightedSum: 0, totalAbatement: 0 };
                }
                ukYearData[year].weightedSum +=
                  item.saf_cost * item.abatement_potential;
                ukYearData[year].totalAbatement += item.abatement_potential;
              } else if (continent) {
                // Track by continent
                if (!continentYearData[continent]) {
                  continentYearData[continent] = {};
                }
                if (!continentYearData[continent][year]) {
                  continentYearData[continent][year] = {
                    weightedSum: 0,
                    totalAbatement: 0,
                  };
                }
                continentYearData[continent][year].weightedSum +=
                  item.saf_cost * item.abatement_potential;
                continentYearData[continent][year].totalAbatement +=
                  item.abatement_potential;
              }
            });
          });

          // Get all years sorted
          const sortedYears = Object.keys(dataByYear)
            .map(Number)
            .sort((a, b) => a - b);

          // Create traces for each continent
          const routeColors = {
            Africa: "#85b09a",
            Asia: "#ff7668",
            Europe: "#d16bd1",
            "North America": "#ffa9a0",
            "South America": "#d62728",
            Oceania: "#1f77b4",
            Other: "#888888",
          };

          const traces = [];

          Object.keys(continentYearData).forEach((continent) => {
            const years = [];
            const vals = [];

            sortedYears.forEach((year) => {
              const yearData = continentYearData[continent][year];
              if (yearData && yearData.totalAbatement > 0) {
                years.push(year);
                vals.push(yearData.weightedSum / yearData.totalAbatement);
              }
            });

            if (years.length > 0) {
              traces.push({
                name: continent,
                x: years,
                y: vals,
                mode: "lines+markers",
                line: {
                  width: 3,
                  color: routeColors[continent] || "#888888",
                  shape: "spline",
                },
                marker: {
                  size: 6,
                  color: routeColors[continent] || "#888888",
                  line: {
                    color: "white",
                    width: 2,
                  },
                },
                hovertemplate:
                  "<b>%{fullData.name}</b><br>" +
                  "Cost: $%{y:,.0f}/tonne<br>" +
                  "<extra></extra>",
              });
            }
          });

          // Add UK trace if data exists
          if (Object.keys(ukYearData).length > 0) {
            const ukYears = [];
            const ukVals = [];

            sortedYears.forEach((year) => {
              const yearData = ukYearData[year];
              if (yearData && yearData.totalAbatement > 0) {
                ukYears.push(year);
                ukVals.push(yearData.weightedSum / yearData.totalAbatement);
              }
            });

            if (ukYears.length > 0) {
              traces.push({
                name: "United Kingdom",
                x: ukYears,
                y: ukVals,
                mode: "lines+markers",
                line: {
                  width: 4,
                  dash: "dot",
                  color: "#000000",
                  shape: "spline",
                },
                marker: {
                  size: 8,
                  color: "#000000",
                  line: {
                    color: "white",
                    width: 2,
                  },
                },
                hovertemplate:
                  "<b>%{fullData.name}</b><br>" +
                  "Cost: $%{y:,.0f}/tonne<br>" +
                  "<extra></extra>",
              });
            }
          }

          let fuel_route_names = selectedRoutes.map((route) => {
            if (route === "btl") {
              return "Biomass to Liquid";
            } else if (route === "atj") {
              return "Alcohol to Jet";
            } else if (route === "hefa") {
              return "Hydroprocessed Esters and Fatty Acids";
            } else if (route === "p2l") {
              return "Power to liquid";
            } else {
              return route.toUpperCase();
            }
          });

          let feedstock_names = selectedFeedstocks.map((feedstock) =>
            feedstock
              .replace(/_/g, " ")
              .toLowerCase()
              .replace(/\b\w/g, (char) => char.toUpperCase()),
          );

          let title = `Average SAF Cost Over Time`;
          if (fuel_route_names.length > 0) {
            title += ` — ${fuel_route_names.join(", ")}`;
          }
          if (feedstock_names.length > 0) {
            title += ` (${feedstock_names.join(", ")})`;
          }

          Plotly.newPlot(
            "routePlot",
            traces,
            {
              hovermode: "x unified",
              xaxis: {
                title: {
                  text: "Year",
                  standoff: 20,
                  font: {
                    family: '"DM Sans", Arial, sans-serif',
                    size: 14,
                    color: "#333",
                  },
                },
                type: "linear",
                showgrid: false,
                linecolor: "#ccc",
                linewidth: 1,
                tickfont: {
                  family: '"DM Sans", Arial, sans-serif',
                  size: 12,
                  color: "#666",
                },
                hoverformat: "Year: %{x}",
              },
              yaxis: {
                title: {
                  text: "Average SAF Cost (USD2024/tonne)",
                  font: {
                    family: '"DM Sans", Arial, sans-serif',
                    size: 14,
                    color: "#333",
                  },
                },
                showgrid: false,
                linecolor: "#ccc",
                linewidth: 1,
                tickfont: {
                  family: '"DM Sans", Arial, sans-serif',
                  size: 12,
                  color: "#666",
                },
              },
              legend: {
                orientation: "h",
                standoff: 20,
                x: 0.5,
                xanchor: "center",
                y: -0.2,
                font: {
                  family: '"DM Sans", Arial, sans-serif',
                  size: 12,
                  color: "#333",
                },
              },
              plot_bgcolor: "white",
              paper_bgcolor: "white",
              margin: {
                l: 60,
                r: 100,
                t: 40,
                b: 120,
              },
              hoverlabel: {
                bgcolor: "rgba(255, 255, 255, 0.95)",
                bordercolor: "rgba(200, 200, 200, 0.8)",
                font: {
                  family: '"DM Sans", Arial, sans-serif',
                  size: 13,
                  color: "#333",
                },
                align: "left",
                namelength: -1,
              },
            },
            {
              responsive: true,
              displayModeBar: false,
              scrollZoom: false,
            },
          );

          // Ensure hover tooltips aren't clipped by plot boundaries
          const plotDiv = document.getElementById("routePlot");
          if (plotDiv) {
            plotDiv.style.overflow = "visible";
            plotDiv.style.setProperty("overflow", "visible", "important");

            // Set overflow on all nested elements that might clip
            const containers = plotDiv.querySelectorAll(
              ".plot-container, .plotly, .svg-container, .main-svg",
            );
            containers.forEach((el) => {
              el.style.overflow = "visible";
              el.style.setProperty("overflow", "visible", "important");
            });
          }
        } catch (e) {
          console.error("updateRoutePlot error", e);
        }
      }

      // Attach listener: use existing fuelRoute control
      function attachListener() {
        // Attach to all fuel route checkboxes
        const fuelRouteCheckboxes = document.querySelectorAll(
          '#fuelRoute input[type="checkbox"]',
        );
        fuelRouteCheckboxes.forEach((checkbox) => {
          checkbox.removeEventListener("change", updateRoutePlot);
          checkbox.addEventListener("change", updateRoutePlot);
        });

        // Attach to all feedstock checkboxes
        const feedstockCheckboxes = document.querySelectorAll(
          '#feedstock input[type="checkbox"], #feedstockGroup input[type="checkbox"]',
        );
        feedstockCheckboxes.forEach((checkbox) => {
          checkbox.removeEventListener("change", updateRoutePlot);
          checkbox.addEventListener("change", updateRoutePlot);
        });
      }

      // Wait for load, then attach and run once
      window.addEventListener("load", function () {
        attachListener();
        // slight delay to allow data parsers to finish if they run on load
        setTimeout(updateRoutePlot, 300);
      });

      // expose for debug
      window.updateRoutePlot = updateRoutePlot;
      document
        .getElementById("hurdleSlider")
        .addEventListener("change", function () {
          updateFilteredData();
        });
      updateYearDisplay();
      updateAbatementDisplay();
      updateMap();
      updateRoutePlot();
    </script>
  </body>
</html>
